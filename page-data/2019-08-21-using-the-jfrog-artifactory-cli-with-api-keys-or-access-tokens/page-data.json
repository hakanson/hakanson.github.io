{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-08-21-using-the-jfrog-artifactory-cli-with-api-keys-or-access-tokens","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"c82021a8-72fc-53fe-8952-134e9b6725b8","excerpt":"I received early adopter access to our JFrog Artifactory instances located at .  After you log in via SSO you are redirected to  (note that  path segment as…","html":"<p>I received early adopter access to our <a href=\"https://jfrog.com/artifactory/\">JFrog Artifactory</a> instances located at <code class=\"language-text\">https://redacted.jfrog.io</code>.  After you log in via SSO you are redirected to <code class=\"language-text\">https://redacted.jfrog.io/redacted/webapp/#/home</code> (note that <code class=\"language-text\">/redacted/</code> path segment as this is needed for API URLs).  I wanted to try CLI access so I started with a simple unauthenticated ”<a href=\"https://www.jfrog.com/confluence/display/RTF/Artifactory+REST+API#ArtifactoryRESTAPI-SystemHealthPing\">ping</a>” using <code class=\"language-text\">curl</code> against the REST API using <a href=\"https://curl.haxx.se/docs/manpage.html#-s\">-s</a> for “silent mode” and <a href=\"https://curl.haxx.se/docs/manpage.html#-i\">-i</a> to include HTTP response header is output, but limit to the first line by piping through <code class=\"language-text\">head</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-i</span> https://redacted.jfrog.io/redacted/api/system/ping <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span>\r\nHTTP/1.1 <span class=\"token number\">200</span> OK</code></pre></div>\n<p>Success. Let’s try some negative testing of my user but with an invalid API key.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">-u</span> <span class=\"token string\">\"0038137:INVALID_APIKEY\"</span> <span class=\"token punctuation\">\\</span>\r\nhttps://redacted.jfrog.io/redacted/api/system/ping <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span>\r\nHTTP/1.1 <span class=\"token number\">401</span> Unauthorized</code></pre></div>\n<p>Now let’s grab my API key and try again.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 288px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94e55ca4dfb7dc82e2d7bccb5aee81e1/477c9/Screen%2BShot%2B2019-08-20%2Bat%2B6.00.29%2BPM.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVQoz42QyUoDQRCG59VERY8eREEET4qKoij4Mi4HD6Ie3EC8uhGQxIvx4FElmkySmZ7N6dk/6YYBDWhS8PF3V9FVf5cxf7LI0tkKSlcv1lk4XWb2eI6h7VGGd8YY3h1jZG98YAzVaPNqi8XzFdYvN1m73GDhbJmpoxmmDmeYPJhmYn9yYIza8yP3tXuqT1XuqnfcPNxSq9e4rlxTqVaov9QxRZuW1aJl98dovDf4bHwiLIHZNGl+NOm0O7y9vqFqVsciSzPSOCVN+mMIR1AUBZ7vEwQBYRjiq/NXQEGBiizPyPN8IAzbtnUT0zQ1lmUhhKDb7ZIkCf+FMtKLbphlGa7ramcyksRxrJFS6mFKf1LmSlfq/S+HeZbjCAfPcbWWqJpyq7SkvCsDaqhak8p5nkcURRjCFviJT8s3caSDE7nYoY0XefSL3u+q0A7jPMGPAsJEamQaIRP5555+Nugd8A23rsUJXvkoJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JFrog Artifactory API Key\"\n        title=\"JFrog Artifactory API Key\"\n        src=\"/static/94e55ca4dfb7dc82e2d7bccb5aee81e1/477c9/Screen%2BShot%2B2019-08-20%2Bat%2B6.00.29%2BPM.png\"\n        srcset=\"/static/94e55ca4dfb7dc82e2d7bccb5aee81e1/12f09/Screen%2BShot%2B2019-08-20%2Bat%2B6.00.29%2BPM.png 148w,\n/static/94e55ca4dfb7dc82e2d7bccb5aee81e1/477c9/Screen%2BShot%2B2019-08-20%2Bat%2B6.00.29%2BPM.png 288w\"\n        sizes=\"(max-width: 288px) 100vw, 288px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">-u</span> <span class=\"token string\">\"0038137:REDACTED_APIKEY\"</span> <span class=\"token punctuation\">\\</span>\r\nhttps://redacted.jfrog.io/redacted/api/system/ping <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span>\r\nHTTP/1.1 <span class=\"token number\">200</span> OK</code></pre></div>\n<p>Notice that I’ve replaced my real API Key with REDACTED_APIKEY above.  Using the real API Key works, but it is long, hard to type, and using it that way exposes it to someone looking in my <code class=\"language-text\">.bash_history</code> file.</p>\n<p>Let’s switch to using the <a href=\"https://www.jfrog.com/confluence/display/CLI/JFrog+CLI\">JFrog CLI</a> and see how that works with my API Key.  Visit the documentation site for full install instructions, including auto-completion scripts.  This CLI works with multiple JFrog products, and <code class=\"language-text\">rt</code> is the target argument for JFrog Artifactory.  The <a href=\"https://www.jfrog.com/confluence/display/CLI/CLI+for+JFrog+Artifactory#CLIforJFrogArtifactory-Configuration\">config</a> command will create a <code class=\"language-text\">~/.jfrog/jfrog-cli.conf</code> file that is used for other CLI commands.  For the command history reason above, I recommend not to use the <code class=\"language-text\">--apikey</code> parameter and enter your API Key in interactive mode.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jfrog <span class=\"token parameter variable\">--version</span>\r\njfrog version <span class=\"token number\">1.27</span>.0\r\n\r\n$ jfrog rt config <span class=\"token parameter variable\">--url</span> https://redacted.jfrog.io/redacted/ <span class=\"token parameter variable\">--user</span> 0038137\r\nArtifactory server ID: redacted\r\nAccess token <span class=\"token punctuation\">(</span>Leave blank <span class=\"token keyword\">for</span> username and password/API key<span class=\"token punctuation\">)</span>: \r\nPassword/API key: \r\n<span class=\"token punctuation\">[</span>Info<span class=\"token punctuation\">]</span> Encrypting password<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>Similar to the REST API, the JFrog CLI supports a <a href=\"https://www.jfrog.com/confluence/display/CLI/CLI+for+JFrog+Artifactory#CLIforJFrogArtifactory-VerifyingArtifactoryisAccessible\">ping command</a> to verify that Artifactory is accessible.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jfrog rt <span class=\"token function\">ping</span>\r\nOK</code></pre></div>\n<p>Taking a peek at the config file, you can see the API Key was stored in the “password” field during the interactive flow.  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> ~/.jfrog/jfrog-cli.conf\r\n<span class=\"token punctuation\">{</span>\r\n  <span class=\"token string\">\"artifactory\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token string\">\"url\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"https://redacted.jfrog.io/redacted/\"</span>,\r\n      <span class=\"token string\">\"user\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"0038137\"</span>,\r\n      <span class=\"token string\">\"password\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"REDACTED_APIKEY\"</span>,\r\n      <span class=\"token string\">\"serverId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"redacted\"</span>,\r\n      <span class=\"token string\">\"isDefault\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>,\r\n  <span class=\"token string\">\"Version\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There is also a <a href=\"https://www.jfrog.com/confluence/display/CLI/CLI+for+JFrog+Artifactory#CLIforJFrogArtifactory-RunningcUrl\">Running cUrl</a> feature to invoke REST APIs not available in the JFrog CLI.  That takes the same arguments as native curl but uses a shortened REST API path and automatically includes login credentials.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jfrog rt <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> GET /api/system/ping\r\nOK</code></pre></div>\n<p>If you really love complicated command lines, you could inject your API Key from the config file using <code class=\"language-text\">jq</code> and still execute <code class=\"language-text\">curl</code> yourself.  Have fun!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".artifactory[0].password\"</span> ~/.jfrog/jfrog-cli.conf\r\nREDACTED_APIKEY\r\n\r\n$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-i</span> <span class=\"token punctuation\">\\</span>\r\n<span class=\"token parameter variable\">-u</span> <span class=\"token string\">\"0038137:<span class=\"token variable\"><span class=\"token variable\">$(</span>jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".artifactory[0].password\"</span> ~/.jfrog/jfrog-cli.conf<span class=\"token variable\">)</span></span>\"</span> <span class=\"token punctuation\">\\</span>\r\nhttps://redacted.jfrog.io/redacted/api/system/ping <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span>\r\nHTTP/1.1 <span class=\"token number\">200</span> OK</code></pre></div>\n<p>Now let’s trying something that is unique to my user by calling the REST API to <a href=\"https://www.jfrog.com/confluence/display/RTF/Artifactory+REST+API#ArtifactoryRESTAPI-GetAPIKey\">Get API Key</a>.  This should echo back the same REDACTED_APIKEY I have in my config file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jfrog rt <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> GET /api/security/apiKey\r\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"apiKey\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"REDACTED_APIKEY\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>For my CI/CD pipelines, I don’t really want my personal API Key being used.  Luckily, JFrog also supports <a href=\"https://www.jfrog.com/confluence/display/ACC/Access+Tokens\">Access Tokens</a> “as a flexible means of authentication with a wide range of capabilities” including:</p>\n<blockquote>\n<ul>\n<li><strong>User and non-user authentication</strong></li>\n</ul>\n<p>The case for authenticating users is clear, however access tokens can also be assigned to non-user entities such as CI server jobs.</p>\n<ul>\n<li><strong>Flexible scope</strong></li>\n</ul>\n<p>By assigning Groups to tokens, you can control the level of access they provide.</p>\n</blockquote>\n<p>Let’s create an access token that is valid for the next 90 seconds and then configure a <code class=\"language-text\">REDACTED_ID</code> entry in our config file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jfrog rt <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST /api/security/token <span class=\"token punctuation\">\\</span>\r\n<span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"username=0038137\"</span> <span class=\"token punctuation\">\\</span>\r\n<span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"scope=member-of-groups:readers\"</span> <span class=\"token punctuation\">\\</span>\r\n<span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"expires_in=90\"</span>\r\n<span class=\"token punctuation\">{</span>\r\n  <span class=\"token string\">\"scope\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"member-of-groups:readers api:*\"</span>,\r\n  <span class=\"token string\">\"access_token\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"REDACTED_TOKEN\"</span>,\r\n  <span class=\"token string\">\"expires_in\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">90</span>,\r\n  <span class=\"token string\">\"token_type\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Bearer\"</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n$ jfrog rt config <span class=\"token parameter variable\">--url</span> https://redacted.jfrog.io/redacted/ <span class=\"token parameter variable\">--user</span> 0038137\r\nArtifactory server ID <span class=\"token punctuation\">[</span>redacted<span class=\"token punctuation\">]</span>: REDACTED_ID\r\nAccess token <span class=\"token punctuation\">(</span>Leave blank <span class=\"token keyword\">for</span> username and password/API key<span class=\"token punctuation\">)</span>: </code></pre></div>\n<p>Quickly use the token with a ping command specifying the <code class=\"language-text\">REDACTED_ID</code> config, then wait for 90 seconds for the token to expire and execute another ping command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jfrog rt <span class=\"token function\">ping</span> --server-id REDACTED_ID\r\nOK\r\n\r\n$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"wait 90 seconds\"</span>\r\n<span class=\"token function\">wait</span> <span class=\"token number\">90</span> seconds\r\n\r\n$ jfrog rt <span class=\"token function\">ping</span> --server-id REDACTED_ID\r\n<span class=\"token punctuation\">[</span>Error<span class=\"token punctuation\">]</span> Artifactory response: <span class=\"token number\">401</span> Unauthorized\r\n<span class=\"token punctuation\">{</span>\r\n  <span class=\"token string\">\"errors\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token string\">\"status\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">401</span>,\r\n      <span class=\"token string\">\"message\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Token failed verification: expired\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When you inspect the JWT payload data from that token, you can see the <code class=\"language-text\">exp</code> time.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jfrt@01dc27m2makwbg11a8k5sr05z2/users/0038137\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"scp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"member-of-groups:readers api:*\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"aud\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jfrt@01dc27m2makwbg11a8k5sr05z2\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"iss\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jfrt@01dc27m2makwbg11a8k5sr05z2\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1566405855</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"iat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1566405765</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"jti\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"47e178d6-0263-4c13-969c-087f79a07a02\"</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately, this still is an Access Token tied to my user account.  There is a way for Admin Users to create Access Token for “non-user entities such as CI server jobs” (mentioned above), so I need to work with our JFrog Artifactory admin to figure out the best way to move forward.</p>","frontmatter":{"title":"Using the JFrog Artifactory CLI with API Keys or Access Tokens","description":null,"date":"August 21, 2019","tags":["devops","cli","security"],"canonical":null}}},"pageContext":{"slug":"/2019-08-21-using-the-jfrog-artifactory-cli-with-api-keys-or-access-tokens","previous":{"fields":{"slug":"/2019-08-12-scanning-for-ows-sql-injection-protection"},"frontmatter":{"tags":["security","codequality","devops","powershell"]}},"next":{"fields":{"slug":"/2019-09-06-veracode-api-hmac-authentication-in-python"},"frontmatter":{"tags":["security","codequality","python"]}}}},"staticQueryHashes":["2589769190","97908498"]}