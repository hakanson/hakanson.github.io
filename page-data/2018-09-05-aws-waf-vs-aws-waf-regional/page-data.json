{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-09-05-aws-waf-vs-aws-waf-regional","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"5800c45e-3089-540d-9cf3-64a9b7c124ca","excerpt":"Welcome - AWS WAF lists separate API references for AWS WAF and AWS WAF Regional.  AWS WAF is “available for protecting Amazon CloudFront distributions” and…","html":"<p><a href=\"https://docs.aws.amazon.com/waf/latest/APIReference/Welcome.html\">Welcome - AWS WAF</a> lists separate API references for AWS WAF and AWS WAF Regional.  AWS WAF is “available for protecting Amazon CloudFront distributions” and AWSWAF Regional is “available for protecting Application Load Balancers.”  These APIs are almost identical, except for Web ACL management:</p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/waf/latest/APIReference/API_regional_AssociateWebACL.html\">AssociateWebACL</a> / <a href=\"https://docs.aws.amazon.com/waf/latest/APIReference/API_regional_DisassociateWebACL.html\">DisassociateWebACL</a> (use WebACLId parameter of <a href=\"https://docs.aws.amazon.com/cloudfront/latest/APIReference/API_UpdateDistribution.html\">UpdateDistribution - Amazon CloudFront</a> )</li>\n<li><a href=\"https://docs.aws.amazon.com/waf/latest/APIReference/API_regional_ListResourcesForWebACL.html\">ListResourcesForWebACL</a> (use <a href=\"https://docs.aws.amazon.com/cloudfront/latest/APIReference/API_ListDistributionsByWebACLId.html\">ListDistributionsByWebACLId - Amazon CloudFront</a> )</li>\n</ul>\n<p>AWS WAF is available globally on CloudFront but only regionally on Application Load Balancers. From <a href=\"https://docs.aws.amazon.com/general/latest/gr/rande.html#waf_region\">AWS Regions and Endpoints - Amazon Web Services</a> (Sept 2018):</p>\n<blockquote>\n<h2>AWS WAF</h2>\n<p>AWS WAF for CloudFront distributions has a single endpoint: waf.amazonaws.com. It supports HTTPS requests only.</p>\n<table>\n<thead>\n<tr>\n<th>Region Name</th>\n<th>Region</th>\n<th>Endpoint</th>\n<th>Protocol</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>US East (N. Virginia)</td>\n<td>us-east-1</td>\n<td>waf.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>Canada (Central)</td>\n<td>ca-central-1</td>\n<td>waf.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>EU (London)</td>\n<td>eu-west-2</td>\n<td>waf.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n</tbody>\n</table>\n<p>AWS WAF for Application Load Balancers has the following endpoints:</p>\n<table>\n<thead>\n<tr>\n<th>Region Name</th>\n<th>Region</th>\n<th>Endpoint</th>\n<th>Protocol</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>US East (Ohio)</td>\n<td>us-east-2</td>\n<td>waf-regional.us-east-2.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>US East (N. Virginia)</td>\n<td>us-east-1</td>\n<td>waf-regional.us-east-1.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>US West (N. California)</td>\n<td>us-west-1</td>\n<td>waf-regional.us-west-1.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>US West (Oregon)</td>\n<td>us-west-2</td>\n<td>waf-regional.us-west-2.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>Asia Pacific (Tokyo)</td>\n<td>ap-northeast-1</td>\n<td>waf-regional.ap-northeast-1.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>Asia Pacific (Sydney)</td>\n<td>ap-southeast-2</td>\n<td>waf-regional.ap-southeast-2.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>EU (Frankfurt)</td>\n<td>eu-central-1</td>\n<td>waf-regional.eu-central-1.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>EU (Ireland)</td>\n<td>eu-west-1</td>\n<td>waf-regional.eu-west-1.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>AWS GovCloud (US)</td>\n<td>us-gov-west-1</td>\n<td>waf-regional.us-gov-west-1.amazonaws.com</td>\n<td>HTTPS</td>\n</tr>\n</tbody>\n</table>\n</blockquote>\n<p>In addition to the documentation, other ways to look for supported regions are a CLI “list” operation or <strong>nslookup</strong> the DNS name.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws waf-regional list-ip-sets <span class=\"token parameter variable\">--region</span> eu-west-2\r\n\r\nCould not connect to the endpoint URL: <span class=\"token string\">\"https://waf-regional.eu-west-2.amazonaws.com/\"</span>\r\n\r\n$ <span class=\"token function\">nslookup</span> waf-regional.eu-west-2.amazonaws.com\r\nServer: <span class=\"token number\">10.204</span>.50.29\r\nAddress: <span class=\"token number\">10.204</span>.50.29<span class=\"token comment\">#53</span>\r\n\r\n** server can't <span class=\"token function\">find</span> waf-regional.eu-west-2.amazonaws.com: NXDOMAIN\r\n\r\n$ <span class=\"token function\">nslookup</span> waf-regional.us-west-2.amazonaws.com\r\nServer: <span class=\"token number\">10.204</span>.50.29\r\nAddress: <span class=\"token number\">10.204</span>.50.29<span class=\"token comment\">#53</span>\r\n\r\nNon-authoritative answer:\r\nName: waf-regional.us-west-2.amazonaws.com\r\nAddress: <span class=\"token number\">52.94</span>.210.110</code></pre></div>\n<p>These <code class=\"language-text\">waf-regional</code> API calls will return different results based on <code class=\"language-text\">--region</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws waf-regional list-ip-sets <span class=\"token parameter variable\">--region</span> us-east-1\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">\"NextMarker\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"7ec3bad0-7b26-491e-affa-00a2718a7160\"</span>,\r\n    <span class=\"token string\">\"IPSets\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n            <span class=\"token string\">\"IPSetId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"777f1102-1803-4730-b666-fc22c452a366\"</span>,\r\n            <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"project1-dev-match-blacklisted-ips\"</span>\r\n        <span class=\"token punctuation\">}</span>,\r\n        <span class=\"token punctuation\">{</span>\r\n            <span class=\"token string\">\"IPSetId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"7ec3bad0-7b26-491e-affa-00a2718a7160\"</span>,\r\n            <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"project2-dev-match-blacklisted-ips\"</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n$ aws waf-regional list-ip-sets <span class=\"token parameter variable\">--region</span> us-west-2\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">\"IPSets\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But the <code class=\"language-text\">waf</code> API call is global and returns the same results, ignoring the CLI <code class=\"language-text\">--region</code> parameter</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws waf list-ip-sets</code></pre></div>\n<p><a href=\"https://aws.amazon.com/firewall-manager/\">AWS Firewall Manager | Centralized WAF Management</a> does not have a separate API, but likely uses <a href=\"https://docs.aws.amazon.com/waf/latest/APIReference/API_regional_PutPermissionPolicy.html\">PutPermissionPolicy - AWS WAF</a> to “share a RuleGroup across accounts.”  A <a href=\"https://docs.aws.amazon.com/waf/latest/APIReference/API_regional_RuleGroup.html\">RuleGroup</a> is a “collection of predefined rules that you can add to a web ACL” and “subject to the following limits:”</p>\n<blockquote>\n<ul>\n<li>Three rule groups per account. You can request an increase to this limit by contacting customer support.</li>\n<li>One rule group per web ACL.</li>\n<li>Ten rules per rule group.</li>\n</ul>\n</blockquote>\n<p>To use <a href=\"https://console.aws.amazon.com/waf/fms#/home\">https://console.aws.amazon.com/waf/fms#/home</a> there are AWS Account level settings that need to be enabled:</p>\n<blockquote>\n<p>Your AWS account must be part of an organization in AWS Organizations, and the account must have the full feature set enabled. <a href=\"http://docs.aws.amazon.com/console/waf/fms-prereq\">Learn more</a></p>\n</blockquote>\n<blockquote>\n<p>An AWS account must be set as an AWS Firewall Manager administrator. <a href=\"http://docs.aws.amazon.com/console/waf/fms-prereq\">Learn more</a></p>\n</blockquote>","frontmatter":{"title":"AWS WAF vs AWS WAF Regional","description":null,"date":"September 5, 2018","tags":["aws","waf","security"],"canonical":null}}},"pageContext":{"slug":"/2018-09-05-aws-waf-vs-aws-waf-regional","previous":{"fields":{"slug":"/2018-09-04-cloud-custodian-code-confusion"},"frontmatter":{"tags":["aws","devops","security"]}},"next":{"fields":{"slug":"/2018-09-06-aws-shield-readonly-and-not-authorized-to-perform-shieldgetsubscriptionstate-work-around"},"frontmatter":{"tags":["aws","iam","security"]}}}},"staticQueryHashes":["2589769190","97908498"]}