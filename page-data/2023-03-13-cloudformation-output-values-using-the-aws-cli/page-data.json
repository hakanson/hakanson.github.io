{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023-03-13-cloudformation-output-values-using-the-aws-cli/","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"388a6d21-d612-5ed2-874a-edfbc41e9661","excerpt":"I was updating the Hello Go CDK sample project and looking for an easy way to get a CloudFormation stack output value for use in a CLI command. The AWS CLI…","html":"<p>I was updating the <a href=\"https://github.com/aws-samples/hello-go-cdk\">Hello Go CDK</a> sample project and looking for an easy way to get a CloudFormation stack output value for use in a CLI command.</p>\n<p>The AWS CLI <a href=\"https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html\">describe-stacks</a> command will get that value, but there is an entire page of JSON to parse through.  Most AWS CLI command support the <code class=\"language-text\">--query</code> global option, which is a “JMESPath query to use in filtering the response data.”  See the <a href=\"https://jmespath.org/specification.html\">JMESPath Specification¶</a> for full details.</p>\n<p>I ran the command below using <code class=\"language-text\">Stacks[].Outputs[]</code> as the JMESPath query to see all the <code class=\"language-text\">Outputs</code>.</p>\n<p><code class=\"language-text\">$ aws cloudformation describe-stacks --stack-name HelloGoAppStage-HelloGoAppStack --query Stacks[].Outputs[]</code></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"OutputKey\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"FargateServiceLoadBalancerDNSXXXXXXXX\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"OutputValue\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hello-alb-0000000000.us-east-1.elb.amazonaws.com\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"OutputKey\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"FargateServiceServiceURLXXXXXXXX\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"OutputValue\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://hello-alb-0000000000.us-east-1.elb.amazonaws.com\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>The above JSON had unique values I redacted using <code class=\"language-text\">XXXXXXXX</code> and <code class=\"language-text\">0000000000</code>.  This makes finding the correct output harder than just matching an exact key value.  Narrowing the <code class=\"language-text\">describe-stacks</code> command down to just <code class=\"language-text\">FargateServiceServiceURLXXXXXXXX</code> required a more complicated JMESPath query - one that would select the “OutputKey” that <a href=\"https://jmespath.org/specification.html#starts-with\">starts_with</a> a “FargateServiceServiceURL” value.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws cloudformation describe-stacks --stack-name HelloGoAppStage-HelloGoAppStack <span class=\"token parameter variable\">--query</span>  <span class=\"token string\">\"Stacks[0].Outputs[?starts_with(OutputKey, 'FargateServiceServiceURL')].OutputValue\"</span> \n<span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"http://hello-alb-0000000000.us-east-1.elb.amazonaws.com\"</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>This output is better, but still a JSON string array with a quoted value.  Another AWS CLI global option is <code class=\"language-text\">--output</code> which indicates the “formatting style for command output” and takes “json”, “text”, or “table” as values.</p>\n<p>I changed my command to use <code class=\"language-text\">--output text</code> and now the value is in the format I need.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws cloudformation describe-stacks --stack-name HelloGoAppStage-HelloGoAppStack <span class=\"token parameter variable\">--query</span>  <span class=\"token string\">\"Stacks[0].Outputs[?starts_with(OutputKey, 'FargateServiceServiceURL')].OutputValue\"</span> <span class=\"token parameter variable\">--output</span> text\nhttp://hello-alb-0000000000.us-east-1.elb.amazonaws.com</code></pre></div>\n<p>The last step was to use the backtick operator to interpolate the value and assign it to the <code class=\"language-text\">HELLO_GO_URL</code> environment variable so I can use it in the subsequent <code class=\"language-text\">curl</code> command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">HELLO_GO_URL</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>aws cloudformation describe-stacks --stack-name HelloGoAppStage-HelloGoAppStack <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"Stacks[0].Outputs[?starts_with(OutputKey, 'FargateServiceServiceURL')].OutputValue\"</span> <span class=\"token parameter variable\">--output</span> text<span class=\"token variable\">`</span></span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-w</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span> <span class=\"token variable\">$HELLO_GO_URL</span>/servicetest</code></pre></div>","frontmatter":{"title":"CloudFormation Output Values using the AWS CLI","description":null,"date":"March 13, 2023","tags":["aws","cli","cloudformation"],"canonical":null}}},"pageContext":{"slug":"/2023-03-13-cloudformation-output-values-using-the-aws-cli/","previous":{"fields":{"slug":"/2023-01-12-resilience-on-aws-at-codefreeze-2023/"},"frontmatter":{"tags":["aws","architecture","disasterrecovery","conference"]}},"next":null}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}