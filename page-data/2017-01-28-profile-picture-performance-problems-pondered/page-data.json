{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-01-28-profile-picture-performance-problems-pondered","webpackCompilationHash":"2ff2dae5022005648504","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"88285442-b150-5381-bb4c-69328cef1a38","excerpt":"In researching browser component UX timings for a project, I found some a slow requests. Here is the likely culprit:  Well, not Kevin Hakanson the person, but…","html":"<p>In researching browser component UX timings for a project, I found some a slow requests. Here is the likely culprit:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 200px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9b7fa4f27929efeffc3355705d598182/9ec3c/pastedImage_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFi0lEQVQ4yyWUfVDThxnHf+5uvd3+6M293FrtWq1CFRQERHwJICICCTQJQhJCyKsxEI1CIiSm4T0iYEQrhrcCUpAQqLwplglMr3i+1DqUdqJ12K1bu63b7ub+2N3+++x33R/fP5675/nc83yf5x5h5ckif3i6xO+/eMTK8hJ/WnnG8+Vlbt9forl3mmN1HVjcAWyueiqqmilt6MXkD3GofgDbqcscaQpR3hLC0zqCP3gFYfTaLUKTNwn0XaM2OIbrzDCWhsvI7Y1s3S5h/55E0iWJ7N8Zhyo7FZ1ajtnZQMnpMLbGQY42DeE8E+bk+VEaxHpB7mxH7uoQ1Ymyogu17xKKI42s+eXPEQQB4QeiVokSVn0fv/LKKjatfx2doxZP2yTucyM4A2FRw7hbwwiFvj60vl70NZfQVfdiO3OF7QcK+NkPBRI2buDt19aw+sev8s4b65BsiiIxIpJNa9eQGJ9Aa88VOsOz+Lsnabl0nc6RWYT2D6/gOBNCKwKN/kF0Vd3EREXheHc/HSfs+A8bsUpzOCqX4zyYh1tTgMdQSEpCDIdKyvjqxdf8/S/f8J9//ZOX332DcC5wlt7QFMcDId7rmMB1Kkjsutc55zDQX13BQLWb80dtnLIYOXXISJPdSltlOUalArVax+LSMp8+eMj8J3eZW7iL4Drhpel0C5PTN5iaXaD98iQ5acmc1OZiz3+XY3l5VGn1VBebsMvzsCpy8FrNlGiLqak7zb3F3xG6Ok//xBzh6ZsIVb46Kt1VXL86Rc/YHM6WfkrUBagku8iITSJpQzSWjGzsuUp2RWwjLSYJVWY2hwuLOHc+yMjMAo29E4zN3OLjm7cRpsfH8JysJngxyJfPn9LR3IY9M5PSXBn7ouNJ2RhNk0WHt0hLWlQC+7btpkgElhn1NNjL6Bu9zgdjM9y6c5/LV+cQvnh4j4vvtzE9Nc5/X37Ho9s3qVQpaT9+hIDNhkehoNtZToPJgl2WS0W+Bo/OREWxmdryKgam5ugKXxU3PE3f+K8R5mau8fzz3/Lti2e8WP4cf/MFbCo1fpOBgKUU+34ZupQcCiVSLMmZvFegx6O3ijnFBBsDLD64/339v//2NS//+keE1tazPH5wh2+/esbKk8ecbrqARqHGIVdgSpeiS04nPy4FZWwqBTvSKJUVUFZowKa3oNGWoNKJpyWCB/oHqPEHEGqqa+nr6eLxZ3f5x59XeLr0kN5gOwZpLoUpGeREJqBan0TB+l3IInej2ZuNSanBqLPi9TbQebGLnu5exkc/wuWuQzjhclNX+3/ovYXfMBIaovuDbirtDnIT92A7II66W0pRfAaGtCxUaZloclSMDQ/zpTjq4qd3RP8nmBWte/LoM4SSEgfl5Sfw+XwMDfYRHhzE462hMN9IWuxOrOK5ePJ12DMKUKcrUGQokKYfJBwa5ZP5Gerr/TjFpioqvbS3tyOYzTbMlhJKSx18PPUR89fG0R+pJl6iJvZXkSRE7yJrZxZSSS7JSZlkJR8gLvYAh70dPFyYZWJkkOPHXSKjFL3RilCk0aFRaynWm+no7qf+wijJhia2K0+yZV0cUWujiXp7B9s2S4iPlhD9xmbeSihE6R2lbeg2/cOTVFZ4sJqt6IsNCIeO1WCuvIDJ9yGKsh4kliAxijq2HmwgTlpJQmQKki1ppG7PJTYilTWb89ioaETqCiGrGKWwdpKys+M46zuxlYtLsZ+dx9R4g3zPMFlHu9ljeJ8NmT5e232Mn0aYWL1WRVKMlB0x2WxMKuEtSSURec3IK0aQOYdQukfQiFBN9RTWlhsI2qoxZI4+0q0d7DVfJEXscIuyiXX7vPzkTR0/WmvmzWgjW9+R8Yt4F6sjLMRoziMtD5HhGCC7bJBUazd7LV3iP53gfyNvsiYXZ9+qAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Kevin Hakanson profile picture\"\n        title=\"Kevin Hakanson profile picture\"\n        src=\"/static/9b7fa4f27929efeffc3355705d598182/9ec3c/pastedImage_4.png\"\n        srcset=\"/static/9b7fa4f27929efeffc3355705d598182/cf440/pastedImage_4.png 148w,\n/static/9b7fa4f27929efeffc3355705d598182/9ec3c/pastedImage_4.png 200w\"\n        sizes=\"(max-width: 200px) 100vw, 200px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Well, not <strong>Kevin Hakanson</strong> the person, but his profile photo which is base64 encoded and included in the body of the JSON response, bloating the size to 105KB and likely adding extra time as well.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d7793201a9c07bc0f0474f84018d176a/2f8d2/pastedImage_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.705882352941178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAe0lEQVQI1z2NzQ6DIBCEff/Xq0Jbq1UQexCoGgWCJKPLwcOXzGZ+tnhUHBV7oiQuXTIOxl9QaoQxFs45aG2QUkLdtJkYI0II8N7j/WmwbTus/aO+dCHkADX+0PUC7bcD3XJQmCaNZV1zaZ4XpOPIXi/kPUhQl55SRkiJE6UVlPaJCdIiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chrome Developer Tools network requests\"\n        title=\"Chrome Developer Tools network requests\"\n        src=\"/static/d7793201a9c07bc0f0474f84018d176a/b9e4f/pastedImage_1.png\"\n        srcset=\"/static/d7793201a9c07bc0f0474f84018d176a/cf440/pastedImage_1.png 148w,\n/static/d7793201a9c07bc0f0474f84018d176a/d2d38/pastedImage_1.png 295w,\n/static/d7793201a9c07bc0f0474f84018d176a/b9e4f/pastedImage_1.png 590w,\n/static/d7793201a9c07bc0f0474f84018d176a/f9b6a/pastedImage_1.png 885w,\n/static/d7793201a9c07bc0f0474f84018d176a/2d849/pastedImage_1.png 1180w,\n/static/d7793201a9c07bc0f0474f84018d176a/2f8d2/pastedImage_1.png 1360w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>That exact same image data is included in multiple responses; both from different endpoints and repeated calls to the same endpoint.</p>\n<p><code class=\"language-text\">/api/profiles/v1/users/F4EB32BB5B1D4F86B126FE07E65CB2D3</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 313px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0950e5b348f17c9d1ba4eff481d42f0f/10448/pastedImage_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.47923322683706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABvElEQVQoz52S3XKjMAyF8/4vtVd7sZluJmmTDSGk4c9gY0wgBNuQwKlwdtrbTjWjEbLGB+mzFkopJGkCljPUTQ2lKiRZhrKqkHGONOfIiwJhkjifcy6lc0Z1dblAlKXL27bFYhgGSCERrAOorMKtVsh3r5Dv7+CnE5LNBmy7RbhcIn55QbxaUX0L7nlI12uo8xkiCFDs/6E3BguQTcOEi1/TYQXhKVxDjj6JYOiS9Q8YaYqpaTDVFxfHOXbd84xEoLXLZ3OCj/6BC2twTQqUyz3U9gjDUrSvG9zoz5Yx6PCMoa6howhWiGfMc1czhMykKaZx/BIUe4kmllCbI65+AB0c0VGHHXV4J7YmDDFQp4aEesFhYhIk1rOoSWIXp2n6LziMkDRq9Jsh+pPj1moY38OV+GniM5QS37HPDu/2gWInka04zr8iiGMFS910Bw+9LDDOnL5pTnDQd/CNQEFdVqcC8q+PK417I4b6FLjxusPB+Zw7JyQ3b+8mmL9NFELTZnwKircCYku7VDXQuzU6egwTx08+BN1mDJb20OaZO7f0CDPPZy1Dz3Ny/sXQ1Ba6MjCtxZ0WdOx7/MQ+AL9d9FckDYqGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chrome Developer Tools\"\n        title=\"Chrome Developer Tools\"\n        src=\"/static/0950e5b348f17c9d1ba4eff481d42f0f/10448/pastedImage_3.png\"\n        srcset=\"/static/0950e5b348f17c9d1ba4eff481d42f0f/cf440/pastedImage_3.png 148w,\n/static/0950e5b348f17c9d1ba4eff481d42f0f/d2d38/pastedImage_3.png 295w,\n/static/0950e5b348f17c9d1ba4eff481d42f0f/10448/pastedImage_3.png 313w\"\n        sizes=\"(max-width: 313px) 100vw, 313px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">/api/profiles/v1/staff-availability/0D08931CA24D498DB6CD6800194B463B</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 338px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/034cec88132160c2c967e417f1be88e2/308c1/pastedImage_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.95857988165681%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2UlEQVQoz51Saa+bMBDk//+vpq3ea8hFQjhCEmHCaYMBJy8c08VpXlOpX9qVRst6rfHuDEaapZCNxBT92H9imPJA6HuM44hnvNZd1+n6NQwWMPBAgHsC1UmiOkrU5wZ11KApW8RJjCRJYNs2HMeBUgphGOJwOOhvKSV834dlWfrckKVE6mWIwwTn4Ax7s4f5ZiJlCY6HEzabtSZkjGG1WmE+nyMIAl0vl0s4+z1sQhRFWFPfmMbvux78KJA4GSEGcyModgb/NkP+4x2t66DZWuDvb0i/ziDMOerVEunsC/hiAUHnzW4LVZYwpr3HYUSyzpC7HFdRQfkHXM8hlOdBEZHyPdQLE2pvU73FlVZUrkvZw/1Cj5MUw8fHQ8Mn4URW+AK5zyHjEpUVozlyDLcb9QeMZMBIBgy/8h+gvuahbT8JKyaRWBnC7xEEK3E9+mhI6BsJ/S9hPJmn6S4miW9eUGcV6p2Lam2hdWwiD3DnhUZXS9yLQqMjzSbcOX9AiAfh0A3InQL8JFDYlN2S1r6hre/oiWASvLE2qNcrMshFS65OdetQJk0ffXrc3v1eOSOi1M3RJERALnc8R1fkeqr/WrnN6SdlNa7tjUbPtXYaLHwYQne0Oa/5L/gJ51VCTkkSF9oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chrome Developer Tools\"\n        title=\"Chrome Developer Tools\"\n        src=\"/static/034cec88132160c2c967e417f1be88e2/308c1/pastedImage_2.png\"\n        srcset=\"/static/034cec88132160c2c967e417f1be88e2/cf440/pastedImage_2.png 148w,\n/static/034cec88132160c2c967e417f1be88e2/d2d38/pastedImage_2.png 295w,\n/static/034cec88132160c2c967e417f1be88e2/308c1/pastedImage_2.png 338w\"\n        sizes=\"(max-width: 338px) 100vw, 338px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>On the surface, this redundancy seems easy to fix: replace <code class=\"language-text\">photo</code> / <code class=\"language-text\">profilePicture</code> with <code class=\"language-text\">photoURL</code> / <code class=\"language-text\">profilePictureURL</code> and add some HTTP caching headers.  After that, the image request will only be made once.  However, if the profile picture image data is being sourced from another system (like an identity provider), there may still be a problem.  There might not be direct URL access to the image and even then, the caching headers may not be set to ensure that any profile picture updates take effect immediately.  It may still be necessary to proxy the image data request.</p>\n<p>With any caching solution, there is a trade-off between performance and stale data.  One solution to this problem is to generate a unique image URL for every photo.  A new image would get a new URL.  Something like:</p>\n<p><code class=\"language-text\">/api/profiles/v1/users/F4EB32BB5B1D4F86B126FE07E65CB2D3/photo/{hash-of-image-data}</code></p>\n<p>This URL will uniquely and deterministically map to that exact image data so the HTTP response can be cached “forever” by the browser.  Also, since the image response can now be binary data instead of a base64 string, there will be about a 25% savings in bytes transmitted.</p>\n<p>With the browser performance problem solved, the server can decide it’s caching strategy, including how often it wants to consult the source of truth and if it wants to cache the image data or just store the hash value.  Profile picture changes don’t happen that often, and if they primarily happen in the UI, they are easy to track and manage the cache.  As few as 1 trip to get the image data might be needed for most sessions.</p>\n<p>There are certainly edge cases, and this isn’t intended to be a full design, but a topic worth investigating.</p>","frontmatter":{"title":"Profile Picture Performance Problems Pondered","date":"January 28, 2017","tags":["webdev","ux","caching"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017-01-28-profile-picture-performance-problems-pondered","previous":{"fields":{"slug":"/2017-01-27-yahoo-maps"},"frontmatter":{"tags":["random"]}},"next":{"fields":{"slug":"/2017-02-06-production-ready-microservices-by-susan-j-fowler"},"frontmatter":{"tags":["microservices","architecture"]}}}}}