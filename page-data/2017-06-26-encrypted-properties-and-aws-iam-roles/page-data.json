{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-06-26-encrypted-properties-and-aws-iam-roles","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"e9914542-4fa6-5064-bc75-0e2235793979","excerpt":"I was working on a pattern for application teams to secure and encrypt sensitive properties like database passwords.  Below is an interaction flow where the DBA…","html":"<p>I was working on a pattern for application teams to secure and encrypt sensitive properties like database passwords.  Below is an interaction flow where the DBA for project 204503 can encrypt a property that only the intended microservice can decrypt.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c56e51dc5ffbee4a74ed930c080f7812/c83ae/pastedImage_14.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABibAAAYmwFJdYOUAAAB8klEQVQoz12R224ScRDGeUrfwhdQ4wP0xgtNelGbeEFpbTXRalpEoCmWHtLCdsvKobi7BVlkS3c5s7Cnn7sLmMZJJv/Jf7755puZmO/7hB6a67o4jhO9tm1HcZhrNn9jmmaEsSwLFnA8lrbkCD22CkISRVEoSSVkOXhLJcrlcvT37MVL4lsJ+v0eekdHUkU6Fwl6+fdYc+cfYWixVRB2dhx7qdTBce0I5Hku31IpBEGIcqPBiMzZPuXcNtP1J4zuRGx/JTRQaBgGrVaLWq2GYZg4M5/t1BrHwodoJjtQ0DP7UUG4ghDvWIthzw7iqOe7tK8/c5HeZTboENN1HU3TGI3G9IYG6n2F47M9xJ9Zmg91ToUjsvkkrQeVyXSM7/nYzpyZNUH8voGafUUn/4abr2tMuspiZM9fdGx2bymKKZRagUI5x7l0xJWcZTe9yU5yg4os0jcHEXY4h3FAoP+6QqtfMfkjYVtDYqvZI8KHWy6rh5TVPPnKIV9OEghahk8Xb0lexxErBe4aDdp9BSOzzlxX+d+WV14obNxXkaQ0jfolxeoPToppbrQcH3ObvNt/zdQdYHZ1DvI76HvPGW89jWp9L3R3cZTHCo2hTl0r0dRl5LZEtSVQb99QapxzLZ8yc6b4cze4VHAgK9ijrkRkjzn+An0NlaBiNq48AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DBA interaction\"\n        title=\"DBA interaction\"\n        src=\"/static/c56e51dc5ffbee4a74ed930c080f7812/fcda8/pastedImage_14.png\"\n        srcset=\"/static/c56e51dc5ffbee4a74ed930c080f7812/12f09/pastedImage_14.png 148w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/e4a3f/pastedImage_14.png 295w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/fcda8/pastedImage_14.png 590w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/efc66/pastedImage_14.png 885w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/c83ae/pastedImage_14.png 1180w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In the diagram:</p>\n<ul>\n<li>A DBA human creates separate database users for service1 and service2</li>\n<li>\n<p>Assuming the <code class=\"language-text\">204503-DBA</code> IAM Role, the DBA encrypts the service1 user’s password (P@ssword1) and encrypts with CMK 1</p>\n<ul>\n<li>Pre-condition: CMK 1 was created with a Resource Policy that allows <code class=\"language-text\">204503-DBA</code> to <code class=\"language-text\">kms:Encrypt</code></li>\n</ul>\n</li>\n<li>\n<p>Assuming the <code class=\"language-text\">204503-DBA</code> IAM Role, the DBA encrypts the service2 user’s password (P@ssword2) and encrypts with CMK 2</p>\n<ul>\n<li>Pre-condition: CMK 2 was created with a Resource Policy that allows <code class=\"language-text\">204503-DBA</code> to <code class=\"language-text\">kms:Encrypt</code></li>\n</ul>\n</li>\n<li>The DBA puts the encrypted data into the location that deploys to the Config Server</li>\n</ul>\n<p>Later, in the diagram:</p>\n<ul>\n<li>\n<p>Instances of service1 are running with the <code class=\"language-text\">204503-service1</code> IAM Role</p>\n<ul>\n<li>They retrieve the encrypted property from the Config Server</li>\n<li>They decrypt the property using CMK 1</li>\n<li>Pre-condition: CMK 1 was created with a Resource Policy that allows <code class=\"language-text\">204503-service1</code> to <code class=\"language-text\">kms:Decrypt</code></li>\n<li>They connect to the database</li>\n</ul>\n</li>\n<li>\n<p>Instances of service2 are running with the <code class=\"language-text\">204503-service2</code> IAM Role</p>\n<ul>\n<li>They retrieve the encrypted property from the Config Server</li>\n<li>They decrypt the property using CMK 2</li>\n<li>Pre-condition: CMK 2 was created with a Resource Policy that allows <code class=\"language-text\">204503-service2</code> to <code class=\"language-text\">kms:Decrypt</code></li>\n<li>They connect to the database</li>\n</ul>\n</li>\n</ul>\n<p>Potentially, this could be altered to support an EncryptionContext with the service name as part of the key-value map.  See <a href=\"https://aws.amazon.com/blogs/security/how-to-protect-the-integrity-of-your-encrypted-data-by-using-aws-key-management-service-and-encryptioncontext/\">How to Protect the Integrity of Your Encrypted Data by Using AWS Key Management Service and EncryptionContext</a>) for more details and look for an upcoming post on the topic.</p>","frontmatter":{"title":"Encrypted Properties and AWS IAM Roles","description":null,"date":"June 26, 2017","tags":["aws","iam","encryption","database","security"],"canonical":null}}},"pageContext":{"slug":"/2017-06-26-encrypted-properties-and-aws-iam-roles","previous":{"fields":{"slug":"/2017-06-25-amazon-elasticsearch-service-and-iam-policies-on-http-methods"},"frontmatter":{"tags":["aws","iam","elasticsearch"]}},"next":{"fields":{"slug":"/2017-06-28-authenticated-encryption-with-the-aws-cli"},"frontmatter":{"tags":["aws","cli","encryption"]}}}},"staticQueryHashes":["2589769190","3567236516"]}