{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-08-24-amazon-rds-and-iam-policy-notes","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"c791c3ab-8754-5f90-a117-515becb1e8f4","excerpt":"As a follow up to Amazon RDS and Tag-Based Permissions, this document digs into an IAM policy that restricts by tag value. Took a look at the AWS Managed…","html":"<p>As a follow up to <a href=\"../2017-04-27-amazon-rds-and-tag-based-permissions\">Amazon RDS and Tag-Based Permissions</a>, this document digs into an IAM policy that restricts by tag value.</p>\n<p>Took a look at the AWS Managed (Predefined) Policies for Amazon RDS, including <code class=\"language-text\">AmazonRDSFullAccess</code> (see <a href=\"http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.AccessControl.IdentityBased.html\">Using Identity-Based Policies (IAM Policies) for Amazon RDS</a>), which includes <code class=\"language-text\">Action</code> <code class=\"language-text\">rds:*</code> for <code class=\"language-text\">Resource</code> <code class=\"language-text\">*</code>.</p>\n<p>The following are the general formats for ARNs; the specific components and values used depend on the AWS service. (see <a href=\"http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#genref-arns\">Amazon Resource Names (ARNs) and AWS Service Namespaces</a> )</p>\n<blockquote>\n<p>arn:partition:service:region:account-id:resource<br>\narn:partition:service:region:account-id:resourcetype/resource<br>\narn:partition:service:region:account-id:resourcetype:resource</p>\n</blockquote>\n<p>RDS has 11 ARN resource types (see <a href=\"http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#arn-syntax-rds\">Amazon Resource Names (ARNs) and AWS Service Namespaces</a>).</p>\n<blockquote>\n<p>arn:aws:rds:region:account-id:db:db-instance-name<br>\narn:aws:rds:region:account-id:snapshot:snapshot-name<br>\narn:aws:rds:region:account-id:cluster:db-cluster-name<br>\narn:aws:rds:region:account-id:cluster-snapshot:cluster-snapshot-name<br>\narn:aws:rds:region:account-id:og:option-group-name<br>\narn:aws:rds:region:account-id:pg:parameter-group-name<br>\narn:aws:rds:region:account-id:cluster-pg:cluster-parameter-group-name<br>\narn:aws:rds:region:account-id:secgrp:security-group-name<br>\narn:aws:rds:region:account-id:subgrp:subnet-group-name<br>\narn:aws:rds:region:account-id:es:subscription-name</p>\n</blockquote>\n<p>Each RDS resource type has its own tag name, like <code class=\"language-text\">db-tag</code> or <code class=\"language-text\">cluster-tag</code> (see <a href=\"http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.ResourcePermissions.html\">Amazon RDS API Permissions: Actions, Resources, and Conditions Reference</a>).</p>\n<p>I tried to add <code class=\"language-text\">StringEqualsIfExists</code> for each RDS tag type, but fails with duplicate keys for <code class=\"language-text\">StringEqualsIfExists</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"StringEqualsIfExists\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"rds:db-tag/xx:project-id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123456\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"StringEqualsIfExists\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"rds:cluster-tag/xx:project-id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123456\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p><em>Note</em>: “You cannot use a wildcard in the portion of the ARN that specifies the resource type” (see <a href=\"http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#arns-paths\">Amazon Resource Names (ARNs) and AWS Service Namespaces</a> ).  Since <code class=\"language-text\">rds</code> is service namespace and <code class=\"language-text\">db</code> or <code class=\"language-text\">snapshot</code> is the resource type, this syntax won’t work.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:*:123456-*\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Therefore, you need to wildcard on resource name prefix (assuming all RDS resources are customer nameable vs. generated).</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:db:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:cluster:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:es:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:og:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:pg:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:cluster-pg:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:secgrp:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:subgrp:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:snapshot:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:cluster-snapshot:123456-*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arn:aws:rds:*:*:ri:123456-*\"</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p><em>Note</em>:  “Policies have a maximum size between 2048 characters and 10,240 characters, depending on what entity the policy is attached to.” (see <a href=\"http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_grammar.html\">Grammar of the IAM Policy Language</a>).</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n     <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"rds:*\"</span>\n     <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"arn:aws:rds:*:123456789012:db:*\"</span>\n     <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"StringEqualsIfExists\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n               <span class=\"token property\">\"rds:db-tag/xx:project-id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123456\"</span>\n          <span class=\"token punctuation\">}</span>\n     <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n     <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"rds:*\"</span>\n     <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"arn:aws:rds:*:123456789012:cluster:*\"</span>\n     <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"StringEqualsIfExists\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n               <span class=\"token property\">\"rds:cluster-tag/xx:project-id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123456\"</span>\n          <span class=\"token punctuation\">}</span>\n     <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>","frontmatter":{"title":"Amazon RDS and IAM Policy Notes","date":"August 24, 2017","tags":["aws","iam","rds"]}}},"pageContext":{"slug":"/2017-08-24-amazon-rds-and-iam-policy-notes","previous":{"fields":{"slug":"/2017-08-15-aws-chalice-amazon-api-gateway-and-aws-iam-authorization"},"frontmatter":{"tags":["aws","iam","python","api"]}},"next":{"fields":{"slug":"/2017-08-30-out-with-hpkp-in-with-caa"},"frontmatter":{"tags":["http","security"]}}}}}