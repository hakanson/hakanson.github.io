{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-06-12-customizing-azure-cloud-shell-using-a-powershell-profile/","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"ea65aa7b-ba8d-5aa8-ab0a-e7669afeef4f","excerpt":"After creating resources in the wrong subscription during some Azure training, I wrote Setting Subscription used inside Azure Cloud Shell.  There I had used theâ€¦","html":"<p>After creating resources in the wrong subscription during some Azure training, I wrote <a href=\"/2020-01-08-setting-subscription-used-inside-azure-cloud-shell\">Setting Subscription used inside Azure Cloud Shell</a>.  There I had used the PowerShell <a href=\"https://docs.microsoft.com/en-us/powershell/module/az.accounts/get-azcontext?view=azps-4.2.0\">Get-AzContext</a> cmdlet to determine my active Azure subscription.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Get-AzContext</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>Property Name<span class=\"token punctuation\">,</span> Subscription<span class=\"token punctuation\">,</span> Tenant <span class=\"token punctuation\">|</span> <span class=\"token function\">Format-List</span>\n\nName         : Windows Azure  MSDN <span class=\"token operator\">-</span> Visual Studio Premium <span class=\"token punctuation\">(</span>11111111-1111-4000-11111111111111111<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> MSI@50342\nSubscription : 1111111-1111-4000-11111111111111111\nTenant       : 00000000-0000-4000-00000000000000000</code></pre></div>\n<p>I was recently reminded <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles?view=powershell-7\">about PowerShell profiles</a> and found I could <a href=\"https://docs.microsoft.com/en-us/azure/cloud-shell/quickstart-powershell#use-custom-profile\">use a custom profile</a> inside Azure Cloud Shell.  If you create a script and save it under <code class=\"language-text\">$profile.CurrentUserAllHosts</code>, it will be loaded during every PowerShell based Azure Cloud Shell session.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Write-Output</span> <span class=\"token variable\">$profile</span><span class=\"token punctuation\">.</span>CurrentUserAllHosts\n<span class=\"token operator\">/</span>home/kevin/<span class=\"token punctuation\">.</span>config/PowerShell/profile<span class=\"token punctuation\">.</span>ps1</code></pre></div>\n<p>Outputting the <code class=\"language-text\">Name</code> property from <code class=\"language-text\">Get-AzContext</code> seemed like and easy way to remind myself of both the Azure subscription name and GUID as soon as I clicked on <a href=\"https://shell.azure.com/\">shell.azure.com</a></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$profile</span><span class=\"token punctuation\">.</span>CurrentUserAllHosts\nMicrosoft<span class=\"token punctuation\">.</span>PowerShell<span class=\"token punctuation\">.</span>Utility\\<span class=\"token function\">Write-Verbose</span> <span class=\"token operator\">-</span>Verbose <span class=\"token operator\">-</span>Message <span class=\"token string\">\"Active Azure Subscription = <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-AzContext</span><span class=\"token punctuation\">)</span></span>.Name)\"</span></code></pre></div>\n<p>Now, when starting a new Azure Cloud Shell session using PowerShell, I am greeted with a reminder of my active Azure subscription:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Requesting a Cloud Shell<span class=\"token punctuation\">.</span>Succeeded<span class=\"token punctuation\">.</span>\nConnecting terminal<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\nMOTD: Scripts installed with <span class=\"token string\">'Install-Script'</span> can be run <span class=\"token keyword\">from</span> the shell\n\nVERBOSE: Authenticating to Azure <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nVERBOSE: Loading AllHosts profile <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nVERBOSE: Active Azure Subscription = Windows Azure  MSDN <span class=\"token operator\">-</span> Visual Studio Premium <span class=\"token punctuation\">(</span>1111111-1111-4000-11111111111111111<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> MSI@50342\nVERBOSE: Building your Azure drive <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin></code></pre></div>\n<p>Notice that I decided to output using <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/write-verbose?view=powershell-7\">Write-Verbose</a> with the <code class=\"language-text\">-Verbose</code> option to match the style of the other startup messages, instead of using <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/write-output?view=powershell-7\">Write-Output</a> or <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/write-host?view=powershell-7\">Write-Host</a>.  Here is how they each behave.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Write-Output</span> <span class=\"token string\">\"test output\"</span>\ntest output\n\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"test host\"</span>\ntest host\n\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"test verbose\"</span>\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Write-Verbose</span> <span class=\"token operator\">-</span>Verbose <span class=\"token string\">\"test verbose\"</span>\nVERBOSE: test verbose\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token variable\">$VerbosePreference</span>\nSilentlyContinue\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token variable\">$VerbosePreference</span> = <span class=\"token string\">\"Continue\"</span>\n<span class=\"token function\">PS</span> <span class=\"token operator\">/</span>home/kevin> <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"test verbose\"</span>\nVERBOSE: test verbose</code></pre></div>","frontmatter":{"title":"Customizing Azure Cloud Shell using a PowerShell Profile","description":null,"date":"June 12, 2020","tags":["azure","powershell","cloudshell"],"canonical":null}}},"pageContext":{"slug":"/2020-06-12-customizing-azure-cloud-shell-using-a-powershell-profile/","previous":{"fields":{"slug":"/2020-06-11-understanding-cis-controls-and-benchmarks/"},"frontmatter":{"tags":["cloud","security","cis"]}},"next":{"fields":{"slug":"/2020-06-26-introduction-to-the-nist-cybersecurity-framework/"},"frontmatter":{"tags":["cloud","security","nist"]}}}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}