{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-05-29-playing-with-terraform-inside-azure-cloud-shell","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"32d39f66-4565-58ba-a795-37f3ff4acb30","excerpt":"I noticed that terraform was one of the tools pre-configured in Azure Cloud Shell, so I decided to play around with it based on the Terraform Getting Startedâ€¦","html":"<p>I noticed that <a href=\"https://www.terraform.io/\">terraform</a> was one of the <a href=\"https://docs.microsoft.com/en-us/azure/cloud-shell/features#tools\">tools pre-configured in Azure Cloud Shell</a>, so I decided to play around with it based on the Terraform <a href=\"https://learn.hashicorp.com/terraform/azure/intro_az\">Getting Started - Azure</a> learning track.</p>\n<p>I created a <code class=\"language-text\">azuredeploy.tf</code> file which would just create an Azure Resource Group named <code class=\"language-text\">myResourceGroupT</code> and Storage Account named <code class=\"language-text\">terraformlabkjh20200529</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kevin@Azure:~$ <span class=\"token function\">cat</span> azuredeploy.tf\nprovider <span class=\"token string\">\"azurerm\"</span> <span class=\"token punctuation\">{</span>\n  version         <span class=\"token operator\">=</span> <span class=\"token string\">\">= 2.0\"</span>\n  features <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"azurerm_resource_group\"</span> <span class=\"token string\">\"example\"</span> <span class=\"token punctuation\">{</span>\n  name     <span class=\"token operator\">=</span> <span class=\"token string\">\"myResourceGroupT\"</span>\n  location <span class=\"token operator\">=</span> <span class=\"token string\">\"Central US\"</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"azurerm_storage_account\"</span> <span class=\"token string\">\"example\"</span> <span class=\"token punctuation\">{</span>\n  name                     <span class=\"token operator\">=</span> <span class=\"token string\">\"terraformlabkjh20200529\"</span>\n  resource_group_name      <span class=\"token operator\">=</span> azurerm_resource_group.example.name\n  location                 <span class=\"token operator\">=</span> azurerm_resource_group.example.location\n  account_tier             <span class=\"token operator\">=</span> <span class=\"token string\">\"Standard\"</span>\n  account_replication_type <span class=\"token operator\">=</span> <span class=\"token string\">\"LRS\"</span>\n\n  tags <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    environment <span class=\"token operator\">=</span> <span class=\"token string\">\"staging\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then after executing a <code class=\"language-text\">terraform init</code> and <code class=\"language-text\">terraform apply</code>, I could see the <code class=\"language-text\">id</code> values of the created resources in the partial output below.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">azurerm_resource_group.example: Creation complete after 1s <span class=\"token punctuation\">[</span>id<span class=\"token operator\">=</span>/subscriptions/11111111-1111-4000-11111111111111111/resourceGroups/myResourceGroupT<span class=\"token punctuation\">]</span>\nazurerm_storage_account.example: Creating<span class=\"token punctuation\">..</span>.\nazurerm_storage_account.example: Still creating<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span>10s elapsed<span class=\"token punctuation\">]</span>\nazurerm_storage_account.example: Creation complete after 20s <span class=\"token punctuation\">[</span>id<span class=\"token operator\">=</span>/subscriptions/11111111-1111-4000-11111111111111111/resourceGroups/myResourceGroupT/providers/Microsoft.Storage/storageAccounts/terraformlabkjh20200529<span class=\"token punctuation\">]</span>\n\nApply complete<span class=\"token operator\">!</span> Resources: <span class=\"token number\">2</span> added, <span class=\"token number\">0</span> changed, <span class=\"token number\">0</span> destroyed.</code></pre></div>\n<p>I also could find these <code class=\"language-text\">id</code> values from inspecting the <code class=\"language-text\">terraform.tfstate</code> file using a <a href=\"https://stedolan.github.io/jq/\">jq</a> query of <code class=\"language-text\">\".resources[].instances[].attributes.id\"</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kevin@Azure:~$ <span class=\"token function\">cat</span> terraform.tfstate <span class=\"token operator\">|</span> jq <span class=\"token string\">\".resources[].instances[].attributes.id\"</span>\n<span class=\"token string\">\"/subscriptions/11111111-1111-4000-11111111111111111/resourceGroups/myResourceGroupT\"</span>\n<span class=\"token string\">\"/subscriptions/11111111-1111-4000-11111111111111111/resourceGroups/myResourceGroupT/providers/Microsoft.Storage/storageAccounts/terraformlabkjh20200529\"</span></code></pre></div>\n<p>I did notice the <code class=\"language-text\">terraform</code> version was out of date inside Azure Cloud Shell.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kevin@Azure:~$ terraform <span class=\"token parameter variable\">--version</span>\nTerraform v0.12.25\n+ provider.azurerm v2.12.0\n\nYour version of Terraform is out of date<span class=\"token operator\">!</span> The latest version\nis <span class=\"token number\">0.12</span>.26. You can update by downloading from https://www.terraform.io/downloads.html</code></pre></div>\n<p>But, then again, so is the version of the Azure CLI.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kevin@Azure:~$ az <span class=\"token parameter variable\">--version</span>\nazure-cli                          <span class=\"token number\">2.5</span>.1 *\n\ncommand-modules-nspkg              <span class=\"token number\">2.0</span>.3\ncore                               <span class=\"token number\">2.5</span>.1 *\nnspkg                              <span class=\"token number\">3.0</span>.4\ntelemetry                          <span class=\"token number\">1.0</span>.4\n\nPython location <span class=\"token string\">'/opt/az/bin/python3'</span>\nExtensions directory <span class=\"token string\">'/home/kevin/.azure/cliextensions'</span>\n\nPython <span class=\"token punctuation\">(</span>Linux<span class=\"token punctuation\">)</span> <span class=\"token number\">3.6</span>.5 <span class=\"token punctuation\">(</span>default, Apr <span class=\"token number\">30</span> <span class=\"token number\">2020</span>, 06:22:39<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>GCC <span class=\"token number\">5.4</span>.0 <span class=\"token number\">20160609</span><span class=\"token punctuation\">]</span>\n\nLegal docs and information: aka.ms/AzureCliLegal\n\n\nYou have <span class=\"token number\">2</span> updates available. Consider updating your CLI installation with <span class=\"token string\">'sudo apt-get update &amp;&amp; sudo apt-get install --only-upgrade -y azure-cli'</span><span class=\"token builtin class-name\">.</span> Detailed instructions can be found at https://aka.ms/doc/UpdateAzureCliApt</code></pre></div>\n<p>A simple example, but now I can add Terraform experience to my resume. :)</p>","frontmatter":{"title":"Playing with Terraform inside Azure Cloud Shell","description":null,"date":"May 29, 2020","tags":["azure","cli","terraform","cloudshell"],"canonical":null}}},"pageContext":{"slug":"/2020-05-29-playing-with-terraform-inside-azure-cloud-shell","previous":{"fields":{"slug":"/2020-05-20-connecting-to-azure-cache-for-redis-from-redisinsight"},"frontmatter":{"tags":["azure","redis","security","networking"]}},"next":{"fields":{"slug":"/2020-06-11-understanding-cis-controls-and-benchmarks"},"frontmatter":{"tags":["cloud","security","cis"]}}}},"staticQueryHashes":["2589769190","97908498"]}