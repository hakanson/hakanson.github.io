{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-01-20-using-aws-x-ray-with-lambdaedge","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"f96f0d20-c928-573a-ab0c-8c1ede2dd31b","excerpt":"One of my original Lambda@Edge functions was still running on an old Node.js runtime, which I needed to update.  That function dynamically generated images of a…","html":"<p>One of my original Lambda@Edge functions was still running on an old Node.js runtime, which I needed to update.  That function dynamically generated images of a United States map with various states shaded based on the filename.  </p>\n<p><code class=\"language-text\">https://redacted.cloudfront.net/license-plate-zone/dynamic/usmap.MN.small.jpg</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe6fcec49e1284752a7dc71d3d408859/7eb62/usmap.MN.small.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHrPVFFB//EABoQAAICAwAAAAAAAAAAAAAAAAERAAIQEjH/2gAIAQEAAQUCZYuYOKaDH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQEBAQEBAAAAAAAAAAAAAAEAESExQf/aAAgBAQABPyFJdgPXS26fs73exB5f/9oADAMBAAIAAwAAABCQD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExYUFRcf/aAAgBAQABPxDa5rkRPUVGZ6dAeCAlzadShtr7mB8n/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"United States map with Minnesota highlighted\"\n        title=\"United States map with Minnesota highlighted\"\n        src=\"/static/fe6fcec49e1284752a7dc71d3d408859/88218/usmap.MN.small.jpg\"\n        srcset=\"/static/fe6fcec49e1284752a7dc71d3d408859/7237a/usmap.MN.small.jpg 148w,\n/static/fe6fcec49e1284752a7dc71d3d408859/0cfdf/usmap.MN.small.jpg 295w,\n/static/fe6fcec49e1284752a7dc71d3d408859/88218/usmap.MN.small.jpg 590w,\n/static/fe6fcec49e1284752a7dc71d3d408859/7eb62/usmap.MN.small.jpg 720w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This image was created from a base SVG, which was parsed and the <code class=\"language-text\">fill</code> color set for each state.  This was subsequently converted into either a JPEG or PNG.  When I first authored this function, I used the X-Ray subsegment functionality to understand the duration of each of these steps.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>AWSXRay<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> subsegment <span class=\"token operator\">=</span> AWSXRay<span class=\"token punctuation\">.</span><span class=\"token function\">getSegment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addNewSubsegment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'generateSVG'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, after updating the code and trying to “Deploy to Lambda@Edge”…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e851d19534f7fc92194da854f7304ee/c5941/deploy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.18181818181819%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABHklEQVQY022Q25KDIBBE+f//25tbXpAoIOhwU8Skku0kL7uppfqhYU4zMExq1XIuhqHjPe/vct6Xo5Syj1J1veBCNG3T9X3HwQmYum7gpdbMmBmaF1JqmiYDQ0j7EGIk55TWKGLrQ0QBVcDL/GBCZK3gymrrbINLpbButsvStFxKbYwdxzGldTtyzJECWbKDlj45SuTXwMLuXF4gGL+Ty5TWdBoGqVRa18vlcrvdwuZom5+YzwRNXmunWCwuFBeLRxg+HmHdkpkM2m5bRvJ6vaYS44N56G6Qt9GwOdoX4bdiwLD0vpcD63zgkUD/YMnOwTL8/LfI+8mat/ePz6r6ruuvqupPJ0zuBXvOlKHPi3AqpULnhVw5znkvIaV/sR8/s76rqQE6LAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Deploy to Lambda@Edge&quot;\"\n        title=\"Deploy to Lambda@Edge&quot;\"\n        src=\"/static/0e851d19534f7fc92194da854f7304ee/799d3/deploy.png\"\n        srcset=\"/static/0e851d19534f7fc92194da854f7304ee/00d96/deploy.png 148w,\n/static/0e851d19534f7fc92194da854f7304ee/0b23c/deploy.png 295w,\n/static/0e851d19534f7fc92194da854f7304ee/799d3/deploy.png 590w,\n/static/0e851d19534f7fc92194da854f7304ee/2a3d6/deploy.png 885w,\n/static/0e851d19534f7fc92194da854f7304ee/c5941/deploy.png 935w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>…I saw this “X-Ray is not supported” error message:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a01888ad23d9b01cb347a13c132176d/ac3a0/xray-not-supported.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.36293436293436%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABhUlEQVQoz4WS+2rbMBTG9dR9n3WFbrAX2AOUrYH+kWyDXJaliZXItu4XW9bN3mmhNLRd9/FDCPkc9Ok7RlyI3f3+ROp9VW22232FhxD8MMD6DlBgnUPWGialNUYrxRhTQowlAyWlHOM7hGFAyerh5139e3Vcr06bNV6vmj/b42bVNaQYmbV4DZx71iYlUHQ2rH9IfOC4au53sAYlPGdJy2L1v8hGFWdQ5xzlnLVt9H5MqcQIhqdpnMB8Ss/kl0ABEm6oW1pVmBACsWF8lEpDHiHG6X9CwvQtZYIL5xwEaK0TQsIIvPflTG83Q9qkbm6+ff94dXX96fOHy8vb2QxuBlzXdX0PgI9xBO/pZXOKkHo4YrxYLJbL5Xw+r+saPoyvdNYMiRQAKesOhJKGwpCbllLKCKkPhwr2HILkXCrJ4RlCQIEECUGlVv3wcLMPyYZsXG8eZLXW8GxrbXwrsLHADKaiTnF3m9kOQdHjL1XKk73ySC4l5XwOnLjOyS70v76qLxdudv0XkFqrdlJYXxMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"X-Ray is not Support\"\n        title=\"X-Ray is not Support\"\n        src=\"/static/8a01888ad23d9b01cb347a13c132176d/799d3/xray-not-supported.png\"\n        srcset=\"/static/8a01888ad23d9b01cb347a13c132176d/00d96/xray-not-supported.png 148w,\n/static/8a01888ad23d9b01cb347a13c132176d/0b23c/xray-not-supported.png 295w,\n/static/8a01888ad23d9b01cb347a13c132176d/799d3/xray-not-supported.png 590w,\n/static/8a01888ad23d9b01cb347a13c132176d/2a3d6/xray-not-supported.png 885w,\n/static/8a01888ad23d9b01cb347a13c132176d/ac3a0/xray-not-supported.png 1036w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Sure enough, when I look at the <a href=\"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/lambda-requirements-limits.html#lambda-requirements-lambda-function-configuration\">Lambda Function Supported Runtimes and Configuration </a> I see this lack of X-Ray support explicitly listed.</p>\n<blockquote>\n<ul>\n<li>AWS X-Ray is not supported.</li>\n</ul>\n</blockquote>\n<p>How was it working for me before?  What had I done differently, or was this a feature which has been disabled for new deployments?  Instead of using the AWS Console, I used the AWS CLI <a href=\"https://docs.aws.amazon.com/cli/latest/reference/lambda/publish-version.html?highlight=edge\">publish-version</a> command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws lambda publish-version --function-name LicensePlateZone-CloudFront-OriginRequest</code></pre></div>\n<p>I then used the AWS Console to update the Behavior on this CloudFront Distribution to specify the version as <code class=\"language-text\">:2</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/779fc3c6cb5b90fe4523adbf5acb0ca3/0b7a7/cloudfront-behavior.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.416378316032294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABJ0AAASdAHeZh94AAAAhUlEQVQI13WP2woDIQxE9/8/Urw0Fbveij7sKjq1oYWl0IGQZMhJyPbMGUR3WGvh3OOTHeacuOq3/yovPqbE9VgzW+8dx3FwnOfJubWGWgu89wghss/AGEgLDiEgxMjL3t64HNvwR7VWaK2hlMK+7yilMExEEEJAGwMpJX9EdINQBsIVvAB/oudogRNH+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda Function Associates\"\n        title=\"Lambda Function Associates\"\n        src=\"/static/779fc3c6cb5b90fe4523adbf5acb0ca3/799d3/cloudfront-behavior.png\"\n        srcset=\"/static/779fc3c6cb5b90fe4523adbf5acb0ca3/00d96/cloudfront-behavior.png 148w,\n/static/779fc3c6cb5b90fe4523adbf5acb0ca3/0b23c/cloudfront-behavior.png 295w,\n/static/779fc3c6cb5b90fe4523adbf5acb0ca3/799d3/cloudfront-behavior.png 590w,\n/static/779fc3c6cb5b90fe4523adbf5acb0ca3/0b7a7/cloudfront-behavior.png 867w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In CloudFront Monitoring, when you look at the “Lambda@edge function metrics” section, it indicates in which regions the functions are invoked.</p>\n<blockquote>\n<p>Lambda@Edge functions are triggered in Regions close to your end users.</p>\n<p>The metrics on this page provide an aggregate view of different Regions in which the Lambda@Edge function executed.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a9667bef8bb83639703c7fd4af87d48/f150c/cloudfront-monitoring.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.61500615006149%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABJ0AAASdAHeZh94AAABtElEQVQ4y61Ui3LCIBDk//+wraPRNJoEzPspJNtbjK19zlRlZofjQpYFjlVl57DPRwx2Ri+IixPKfsI8Txj6Hl3XYRiGT3G/xM45XLd5nqGapkFZlsjyHEmSwBwzaG3OuSwT5EjTFLl8Z+54PPqx1hpFUZwheQpgU5wQhjus12sEmw22261HGIaIokjinSDAbnceM//y/IwgCLBarbCRf+I4xniycJMopHSuTHC1qqpQ1zUqQb2gaepFbea/c1dUXLz/l6NqR7SjgxpGCYS047ks4Lhp209g7jr/PW78QooDI9vWxvieoFJOrGXCf+AJR1EYxwe8vkZI5Cz2ck7c5uXW/tuUlau3X67/QnYLlLXW1xZr6laSXwnvUfZBKETvhA9RKER8Ss5Ni0IBboff8jTJ2z31wNgI2rvwcYb2BEwWs7sPimfXShGTmJKne8/wmvBhl0KD8IQPKRsh4vP77Zn9lP8r57dMhTQEkrP3ziylRIu6zrG8SondkuNlXuyP89ir0TqYrPQGQX+jWdL3+nQtRhHKpApP+yekOhW3zpCKq3disofDwY+10Ugig8wU4vgx3gB12Bl51JhahgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CloudFront &gt; Monitoring &gt; LicensePlateZone-CloudFront-OriginRequest:2\"\n        title=\"CloudFront &gt; Monitoring &gt; LicensePlateZone-CloudFront-OriginRequest:2\"\n        src=\"/static/3a9667bef8bb83639703c7fd4af87d48/799d3/cloudfront-monitoring.png\"\n        srcset=\"/static/3a9667bef8bb83639703c7fd4af87d48/00d96/cloudfront-monitoring.png 148w,\n/static/3a9667bef8bb83639703c7fd4af87d48/0b23c/cloudfront-monitoring.png 295w,\n/static/3a9667bef8bb83639703c7fd4af87d48/799d3/cloudfront-monitoring.png 590w,\n/static/3a9667bef8bb83639703c7fd4af87d48/f150c/cloudfront-monitoring.png 813w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>AWS X-Ray is supported in Ohio (us-east-2) where this executed…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e031cc1b5d07282fde5f97db1f874114/3a775/xray-regions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.601532567049809%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABJ0AAASdAHeZh94AAAAj0lEQVQI102O2wrDIBBE8/9fmKcQ00YwQYrGe9Spu6WQhcGzDM7sdBwHaM7zxL5L9N7hnENrDd47pJRgrcW6rsg5M8cYhwJzKQXLsiANT0qJSSnFgVprDqShwForrutipo9CiBGSYIwZRZ5FTN48z6Cc17Zhen+G4Tzuu/A1v/YIHwLvYbx0GenpP5mK/yVfJ8nmckCTV04AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS X-Ray Regions\"\n        title=\"AWS X-Ray Regions\"\n        src=\"/static/e031cc1b5d07282fde5f97db1f874114/799d3/xray-regions.png\"\n        srcset=\"/static/e031cc1b5d07282fde5f97db1f874114/00d96/xray-regions.png 148w,\n/static/e031cc1b5d07282fde5f97db1f874114/0b23c/xray-regions.png 295w,\n/static/e031cc1b5d07282fde5f97db1f874114/799d3/xray-regions.png 590w,\n/static/e031cc1b5d07282fde5f97db1f874114/2a3d6/xray-regions.png 885w,\n/static/e031cc1b5d07282fde5f97db1f874114/3a775/xray-regions.png 1044w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>..and my code dynamically detects X-Ray support and will <code class=\"language-text\">console.log</code> the <code class=\"language-text\">awsRequestId</code> to assist my future debugging.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">AWS_XRAY_DAEMON_ADDRESS</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> segmentName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span>_HANDLER <span class=\"token operator\">||</span> <span class=\"token string\">'index.handler'</span><span class=\"token punctuation\">;</span>\n        subsegment <span class=\"token operator\">=</span> AWSXRay<span class=\"token punctuation\">.</span><span class=\"token function\">getSegment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addNewSubsegment</span><span class=\"token punctuation\">(</span>segmentName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        subsegment<span class=\"token punctuation\">.</span><span class=\"token function\">addMetadata</span><span class=\"token punctuation\">(</span><span class=\"token string\">'event'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        subsegment<span class=\"token punctuation\">.</span><span class=\"token function\">addMetadata</span><span class=\"token punctuation\">(</span><span class=\"token string\">'context'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>awsRequestId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            subsegment<span class=\"token punctuation\">.</span><span class=\"token function\">addAnnotation</span><span class=\"token punctuation\">(</span><span class=\"token string\">'awsRequestId'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">.</span>awsRequestId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">AWS X-Ray filter:  Annotation.awsRequestId = \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>context<span class=\"token punctuation\">.</span>awsRequestId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>When I go to <code class=\"language-text\">CloudWatch &gt; Log Groups &gt; /aws/lambda/us-east-1.LicensePlateZone-CloudFront-OriginRequest</code> in Ohio, I can just copy that X-Ray filter expression…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2020-01-20T04:25:45.932Z\tc80d37f9-1805-4233-8ca3-b0f86d73cd02\tINFO\tAWS X-Ray filter:  Annotation.awsRequestId = &quot;c80d37f9-1805-4233-8ca3-b0f86d73cd02&quot;</code></pre></div>\n<p>…and use to find the <code class=\"language-text\">Trace</code>.  Here is the <code class=\"language-text\">Timeline</code> for that request with a timing breakdown for <code class=\"language-text\">generateSVG</code> and <code class=\"language-text\">generateImage</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c83290017aed233adcd5d5db65ec2bb/bcfbe/xray-timeline.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.158815612382238%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABJ0AAASdAHeZh94AAAA6UlEQVQY04WQy07EIBSG+/4PYxwXJhMTE917SUZn1JULKde0FOhMgdJfwExj3Ejy5TtczuFAQymFlBJKqZUyL+tt21ZzxtApASU4lOSQ4hecZTOI7LLfaK3BcgIhpCYXt9nGDHDOIUQPPU54+OywJ/pfGmPM2lWxEKLaew9rLexpxJxm0P6Iq+cWmydSufzDxeMXti8MTQgBnPNcIKCMZVlwHsMwQNoeCTPcKWD7ynC9o7jZc9x/SNy9Z7JLfPsmcKAGzTRNtaMQ41rwjLUOndMIKSKlBT7O+dyMo4/ox/IVP5TY5AtJfsU3fKp2MGNKJd8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS X-Ray Timeline\"\n        title=\"AWS X-Ray Timeline\"\n        src=\"/static/3c83290017aed233adcd5d5db65ec2bb/799d3/xray-timeline.png\"\n        srcset=\"/static/3c83290017aed233adcd5d5db65ec2bb/00d96/xray-timeline.png 148w,\n/static/3c83290017aed233adcd5d5db65ec2bb/0b23c/xray-timeline.png 295w,\n/static/3c83290017aed233adcd5d5db65ec2bb/799d3/xray-timeline.png 590w,\n/static/3c83290017aed233adcd5d5db65ec2bb/2a3d6/xray-timeline.png 885w,\n/static/3c83290017aed233adcd5d5db65ec2bb/ae92f/xray-timeline.png 1180w,\n/static/3c83290017aed233adcd5d5db65ec2bb/bcfbe/xray-timeline.png 1486w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Also, some of the <code class=\"language-text\">Raw data</code> JSON for that <code class=\"language-text\">Trace</code>, which shows the <code class=\"language-text\">request_id</code> and <code class=\"language-text\">resource_arn</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">    <span class=\"token property\">\"Document\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"48105c4f14533917\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"us-east-1.LicensePlateZone-CloudFront-OriginRequest\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"start_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1579494345.905</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"end_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1579494346.164</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"http\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"response\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"aws\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"request_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"c80d37f9-1805-4233-8ca3-b0f86d73cd02\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"trace_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1-5e252bc9-e3c78f382891b2ccf6c99a18\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"origin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AWS::Lambda\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"resource_arn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:lambda:us-east-2:0123456789012:function:us-east-1.LicensePlateZone-CloudFront-OriginRequest:2\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This shows that when CloudFront invokes a Lambda@Edge function in an AWS Region that supports AWS X-Ray, it works as expected.  However, this still might not mean it is “supported” by AWS, so use at your own risk.</p>","frontmatter":{"title":"Using AWS X-Ray with Lambda@Edge","date":"January 20, 2020","tags":["aws","xray","cloudfront","monitoring"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2020-01-20-using-aws-x-ray-with-lambdaedge","previous":{"fields":{"slug":"/2020-01-08-setting-subscription-used-inside-azure-cloud-shell"},"frontmatter":{"tags":["azure","cli","powershell","cloudshell"]}},"next":{"fields":{"slug":"/2020-02-03-aws-ux-issues-when-under-load"},"frontmatter":{"tags":["aws","ux","codequality","random"]}}}}}