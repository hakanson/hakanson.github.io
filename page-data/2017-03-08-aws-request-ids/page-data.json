{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-03-08-aws-request-ids","webpackCompilationHash":"f141a48750e2a6a883f2","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"acf2db3a-ecfe-551e-9b0b-7859a563365f","excerpt":"I was reading Techniques and Tools for Better Serverless API Logging with Amazon API Gateway and AWS Lambda when I came across a reference to the x-amzn…","html":"<p>I was reading <a href=\"https://aws.amazon.com/blogs/compute/techniques-and-tools-for-better-serverless-api-logging-with-amazon-api-gateway-and-aws-lambda/\">Techniques and Tools for Better Serverless API Logging with Amazon API Gateway and AWS Lambda</a> when I came across a reference to the <strong>x-amzn-RequestId</strong> HTTP response header.  This appears to be a common way for Amazon services to return a unique request id. Each service has documentation similar to this:</p>\n<blockquote>\n<p><strong>x-amzn-RequestId</strong></p>\n<p>A value created by Amazon {service} that uniquely identifies your request. If you have a problem with Amazon {service}, AWS can use this value to troubleshoot the problem. We recommend that you log these values.</p>\n</blockquote>\n<p>(<em>Note</em>: S3 is an exception using <strong>x-amz-request-id</strong> (and optionally <strong>x-amz-id-2 )</strong>, and CloudFront adds an <strong>X-Amz-Cf-Id</strong> request header before forwarding to your origin.)</p>\n<p>Assuming you are not making raw HTTP requests and are using an AWS SDK, this value becomes easy to access using the <strong>requestId</strong> property of the response.</p>\n<p>I started to wonder how this relates to the <strong>X-Amzn-Trace-Id</strong> <a href=\"http://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-tracingheader\">Tracing Header</a> from AWS X-Ray, which uses an extendable <strong>Field=version-time-id</strong> format.  Here is an example:</p>\n<blockquote>\n<p>X-Amzn-Trace-Id: Root=1-5759e988-bd862e3fe1be46a994272793; Parent=53995c3f42cd8ad8; Sampled=1</p>\n</blockquote>\n<p>The answer is probably as simple as request tracing vs. response logging, but does the AWS X-Ray SDK take advantage of this common request id?  Looking at the Node.js SDK source code, I see that <code class=\"language-text\">patchers/aws_p.js</code> uses <code class=\"language-text\">segments/attributes/aws.js</code> which has this line of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>request_id <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>extendedRequestId <span class=\"token operator\">||</span> res<span class=\"token punctuation\">.</span>requestId <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It is logged as an attribute of subsegments related to AWS services. However, I could have found this by looking at the example from <a href=\"http://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-nodejs-awssdkclients.html\">Tracing AWS SDK Calls with the X-Ray SDK for Node.js</a>.</p>\n<p>In the end, it looks like Amazon’s advice to “log these values” ourselves s what we should do. That will give us the best option to log other important data alongside the request id and not have to worry if our tracing request was sampled.</p>","frontmatter":{"title":"AWS Request IDs","date":"March 08, 2017","tags":["aws","http","monitoring"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017-03-08-aws-request-ids","previous":{"fields":{"slug":"/2017-03-02-cli-saml-authentication-and-aws-sts-assume-role"},"frontmatter":{"tags":["aws","iam","cli"]}},"next":{"fields":{"slug":"/2017-03-09-thou-shalt-not-depend-on-me-analysing-the-use-of-outdated-javascript-libraries-on-the-web"},"frontmatter":{"tags":["javascript","security"]}}}}}