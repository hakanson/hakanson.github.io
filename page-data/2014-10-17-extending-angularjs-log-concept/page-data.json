{"componentChunkName":"component---src-templates-blog-post-js","path":"/2014-10-17-extending-angularjs-log-concept","webpackCompilationHash":"2ff2dae5022005648504","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"a1f0db65-9b99-5347-8b7f-8ec1f3785e2c","excerpt":"Logging is an important component of monitoring an application.  AngularJS provides $log which is documented as: Simple service for logging. Default…","html":"<p>Logging is an important component of monitoring an application.  AngularJS provides <a href=\"https://docs.angularjs.org/api/ng/service/$log\">$log</a> which is documented as:</p>\n<blockquote>\n<p>Simple service for logging. Default implementation safely writes the message into the browser’s console (if present).</p>\n<p>The main purpose of this service is to simplify debugging and troubleshooting.</p>\n</blockquote>\n<p>I wanted to extend this front-end logging in a few ways, including named loggers and capturing these log messages alongside our back-end logs.  My Google results found some prior art in this area:</p>\n<ul>\n<li><a href=\"http://engineering.talis.com/articles/client-side-error-logging/\">Logging client side errors server-side in AngularJS</a></li>\n<li><a href=\"http://www.stacktracejs.com/\">stacktrace.js</a></li>\n<li><a href=\"http://www.stacktracejs.com/\">log4javascript</a></li>\n<li><a href=\"http://js.jsnlog.com/Documentation/GetStartedLogging/AngularJsErrorHandling\">JSNLog AngularJS Error Handling</a></li>\n<li><a href=\"https://github.com/ThomasBurleson/angularjs-logDecorator\">ThomasBurleson angularjs-logDecorator</a></li>\n<li><a href=\"http://solutionoptimist.com/2013/10/07/enhance-angularjs-logging-using-decorators/\">Enhancing AngularJS Logging using Decorators</a></li>\n</ul>\n<p>For my experimentation, I created a simple AngularJS based application called “Math Demo” that intentionally has errors which appear in the console using <code class=\"language-text\">$log</code>.  Here is a screenshot of the home page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eba5be1fdc3c4bd81960609ba83a1e88/2f8d2/MathDemo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.691176470588225%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcSAAAXEgFnn9JSAAABn0lEQVQoz5VSYXOiQAzl//+pfr125s5qQSxz0gosrCwioigLknebtTgdr871diaTzSZ5yebFqVRD+WqHQtRQSQX5voVue5zPZ3w+RITvHIdwHlYLSc8PIQVuSN7Co/l8TrPpjJJEkJSSttsto9EFl673r8TRuqXli8DkYUnTHwv8+vmM2WyKyWQCA4qnxye4roc8z7Hb1ddu73Xs9H1HcbCG/xhTGKyweH1FEATwfd/K8vcSnuchjhM7hhHsnjhEA1XqABkVpGSJzWaD/X6Pw+GA4/GIpmmgtcYwDN+bIXeYhgVCX1BZlaiqCl3X/RXI1Rn0nx2aDqhpjmhPmjiBpe97C3or/D76xvutOK7rEs/og6X/Orfd2S8b9sx6JMwirddrKFWANbOqlLI6z9WHXVhtVunLsVwBZZbBgFKapjb4LXxjG3EUI8tSw3AM9gkhjC3B8VykKAorXDgzb3Vdw8nSjIRILSAnikQgskDSgkZRZLSwhdi+gGYoNyXatrUbwPp0Ol1maFonfRk6sZMdWo8kdHZ9OGEkg2N4ne59+Q8tpJmETNWDOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Math Demo\"\n        title=\"Math Demo\"\n        src=\"/static/eba5be1fdc3c4bd81960609ba83a1e88/b9e4f/MathDemo.png\"\n        srcset=\"/static/eba5be1fdc3c4bd81960609ba83a1e88/cf440/MathDemo.png 148w,\n/static/eba5be1fdc3c4bd81960609ba83a1e88/d2d38/MathDemo.png 295w,\n/static/eba5be1fdc3c4bd81960609ba83a1e88/b9e4f/MathDemo.png 590w,\n/static/eba5be1fdc3c4bd81960609ba83a1e88/f9b6a/MathDemo.png 885w,\n/static/eba5be1fdc3c4bd81960609ba83a1e88/2d849/MathDemo.png 1180w,\n/static/eba5be1fdc3c4bd81960609ba83a1e88/2f8d2/MathDemo.png 1360w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>I decorated <code class=\"language-text\">$log</code> with my log provider, used <code class=\"language-text\">app.name</code> (which is “math”) as the default named logger, and configured the logging levels and server side endpoint.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'$provide'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fef$logProvider'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">$provide<span class=\"token punctuation\">,</span> fef$logProvider</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $provide<span class=\"token punctuation\">.</span><span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token string\">'$log'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"$delegate\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">$delegate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fef$logProvider<span class=\"token punctuation\">.</span><span class=\"token function\">decorate</span><span class=\"token punctuation\">(</span>$delegate<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> $delegate<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'fef$log'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">fef$log</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  fef$log<span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> consoleThreshold<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n      httpThreshold<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> httpURL<span class=\"token punctuation\">:</span> <span class=\"token string\">'/log'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">fef$logProvider</code> supports the same API as <code class=\"language-text\">$log</code>, so when <code class=\"language-text\">binaryCalculator</code> loads…</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'binaryCalculator'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">$log</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loading'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>… you see the “loading” message as expected, but prefixed by a timestamp and the top level <code class=\"language-text\">math</code> named logger.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2014-10-16T20:07:16.390Z [math] loading</code></pre></div>\n<p>But when the <code class=\"language-text\">unaryCalculator</code> is loading…</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unaryCalculator'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">fef$log<span class=\"token punctuation\">,</span> $q</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> $log <span class=\"token operator\">=</span> fef$log<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unaryCalculator'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  $log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loading'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>…the named logger is set to <code class=\"language-text\">math:unaryCalculator</code> and that appears in the output.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2014-10-16T20:07:34.616Z [math:unaryCalculator] loading</code></pre></div>\n<p>I added a debug level log message as output for <code class=\"language-text\">$routeChangeSuccess</code> events.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">$rootScope<span class=\"token punctuation\">.</span><span class=\"token function\">$on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$routeChangeSuccess\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> aRoute<span class=\"token punctuation\">,</span> bRoute</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fef$log<span class=\"token punctuation\">.</span><span class=\"token function\">pageguid</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The output to the browser console includes the event name in the named logger: <code class=\"language-text\">math:$rootScope.$on</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2014-10-16T19:42:07.019Z [math:$rootScope.$on] $locationChangeStart\n2014-10-16T19:42:07.020Z [math:$rootScope.$on] $locationChangeSuccess  http://localhost:3000/#/ -&gt; http://localhost:3000/#/unary/sqrt\n2014-10-16T19:42:07.021Z [math:$rootScope.$on] $routeChangeStart\n2014-10-16T19:42:07.027Z [math:$rootScope.$on] $routeChangeSuccess\n2014-10-16T19:42:07.031Z [math:unaryEquation] loading\n2014-10-16T19:42:07.034Z [math:unaryCalculator] loading\n2014-10-16T19:42:07.034Z [math] loading\n2014-10-16T19:42:07.035Z [math:UnaryOperatorCtrl] loading\n2014-10-16T19:42:07.046Z [math:equationInput] loading</code></pre></div>\n<p>An internal tool for <strong>TR</strong>ransaction <strong>M</strong>onitoring and <strong>R</strong>eporting (TRMR) supports distributed tracing uses the <code class=\"language-text\">x-cobalt-pcid</code> HTTP header to provide the “page” or “root” level tracing GUID.  This code generates a <a href=\"https://www.ietf.org/rfc/rfc4122.txt\">RFC 4122</a> version 4 UUID and set the HTTP header.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">trmrguid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[xy]/g</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">16</span> <span class=\"token operator\">|</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      v <span class=\"token operator\">=</span> c <span class=\"token operator\">==</span> <span class=\"token string\">'x'</span> <span class=\"token operator\">?</span> r <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x3</span> <span class=\"token operator\">|</span> <span class=\"token number\">0x8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> v<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> rootname <span class=\"token operator\">=</span> <span class=\"token string\">\"fef\"</span><span class=\"token punctuation\">,</span> rootGuid <span class=\"token operator\">=</span> <span class=\"token function\">trmrguid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">generatePageGuid</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$http</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  rootGuid <span class=\"token operator\">=</span> <span class=\"token function\">trmrguid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  $http<span class=\"token punctuation\">.</span>defaults<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">[</span><span class=\"token string\">'x-cobalt-pcid'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> rootGuid<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token function\">createData</span><span class=\"token punctuation\">(</span>rootname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  data<span class=\"token punctuation\">.</span>level <span class=\"token operator\">=</span> <span class=\"token string\">'page'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">logHttp</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Log events are posted to the server side using a JSON structure containing the same timestamp,  logger name, and message output to the browser console.  It also includes the URL, logging level, and the tracability “root” guid generated above.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"items\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"b2ff983e5fe04316af5642a1fbd014ca\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"math:$rootScope.$on\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2014-10-16T19:47:49.308Z\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:3000/#/\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"level\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"debug\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"messages\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"$routeChangeSuccess\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"433b218a10d24b6ead6988d004aeeff1\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"math\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2014-10-16T19:47:49.308Z\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:3000/#/\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"level\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"page\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, to avoid being to “chatty” over HTTP for each log message, there is a configurable minimum delay to buffer log events.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> logBuffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">logHttp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">logData</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logBuffer<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// use setTimeout/XMLHttpRequest instead of</span>\n    <span class=\"token comment\">// $timeout/$http to avoid circular errors</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> logRequest <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logRequest<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> baseConfig<span class=\"token punctuation\">.</span>httpURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logRequest<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> version<span class=\"token punctuation\">:</span> <span class=\"token string\">\"0.1\"</span><span class=\"token punctuation\">,</span> items<span class=\"token punctuation\">:</span> logBuffer <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            logBuffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> baseConfig<span class=\"token punctuation\">.</span>delay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    logBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>logData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In this “Square Root” example, you can see the different components being used.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 487px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5053a2c06889519b65cb8334e4ccf3b0/7b2ae/SquareRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.17453798767967%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcSAAAXEgFnn9JSAAABX0lEQVQoz61RTU/CQBDtn8d6kqsQDyQmRg9yEpQEOIgIxeBBWoXWkhBpG2hooaSllHae201q1Ph1cJKXmcm+t/MlmKZprzzPBvCGOI65f9Y023FdHidJbEdRxGMi+sB/D6FWu0Iut4fjUgknp2coFI9QLBxCVhSI4j7EPRHn5TIO8nk8DGT8ZsJyuSSp26XLapUGskySdEeaqpJlWaTrOimKTMPhkGRZoYXjENPQTybgn03Y7XbYbDYcQRBgvV5zn8L3fY4sTzlhGHLP9olUmyGKtkgSgvD0KOOiUsFoNILjuLBt+8vKbBqwYzFRwrFYLDCfzzGZTJhmDmP6giDcQrBMA6qmsccZJxjTKVYrD+OxDtO04LouZrMZ7zzthE/gB0hYgTT3PI93nxUV1NGQX++mdY3bTgeNRh1Sr4f7fh/NZgOtdhvNegMKu3o6pmEYvMi3O8x+/oulvIybxZ/xCo32p0KmQfhdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Square Root UI\"\n        title=\"Square Root UI\"\n        src=\"/static/5053a2c06889519b65cb8334e4ccf3b0/7b2ae/SquareRoot.png\"\n        srcset=\"/static/5053a2c06889519b65cb8334e4ccf3b0/cf440/SquareRoot.png 148w,\n/static/5053a2c06889519b65cb8334e4ccf3b0/d2d38/SquareRoot.png 295w,\n/static/5053a2c06889519b65cb8334e4ccf3b0/7b2ae/SquareRoot.png 487w\"\n        sizes=\"(max-width: 487px) 100vw, 487px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">/unary/:operation</code> routes to <code class=\"language-text\">unary.html</code> which references <code class=\"language-text\">&lt;unary-equation&gt;</code></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>{{label}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>unary-equation</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>unary-equation</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        (Calculate Remote:\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>useRemote<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>useRemote”\n             type=<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">checkbox\"</span> <span class=\"token attr-name\">ng-model</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>useRemote<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>)\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><code class=\"language-text\">unary-equation.html</code> references <code class=\"language-text\">&lt;equation-input&gt;</code> and renders the “calculate” button</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{{ operation }}\n(\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>equation-input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>x<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ng-model</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>model.x<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>equation-input</span><span class=\"token punctuation\">></span></span>\n)\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">ng-click</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>calculate()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>=<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n{{ result }}</code></pre></div>\n<p><code class=\"language-text\">equation-input.html</code> renders the <code class=\"language-text\">&lt;input&gt;</code> field</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>number<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ng-required</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{name}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>In the browser console screenshot below, you can see each component does some debug logging while “loading”.  There is also either “info” or “error” logging depending the the result of the <code class=\"language-text\">calculate</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">$scope<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">calculate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'calculating...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> calculator <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>$scope<span class=\"token punctuation\">.</span>useRemote <span class=\"token operator\">?</span> unaryCalculatorRemote <span class=\"token punctuation\">:</span> unaryCalculator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  calculator<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span>$scope<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> $scope<span class=\"token punctuation\">.</span>operation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    $scope<span class=\"token punctuation\">.</span>result <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span>\n    $log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>$scope<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">reason</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    $scope<span class=\"token punctuation\">.</span>result <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    $log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>reason<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/090ff227c8ae6fb1de1707a6311489bd/179f0/ChromeConsole.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.55613126079447%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABcSAAAXEgFnn9JSAAABUElEQVQoz2WRC2+CQBCE+f//ra0o4PGWQ8AqT0kNGm6mC8YmjSRfZpm9XeaC5SuDLDPwfYMoEsIni5cdDLQ2CKSXpgbF0SAMRAsD0sCYd6zPD3DvgZsvcLd96sLi+Qp0HXBrg1UFti3Yd2CuwWmSnQSB/1hb23D5qm3PcF0D1zFwnBmxpA1DSCLAc4E0AarSIM8FDdxuMi0r3hIq1fBw6OEHLaNooWOWjeINjOOOYdhR+TWDoOPxODJNf6TfS+KOwzCuqV7PmtD1KiZJDU9UqZMMfjNOLovHMJI6PnOvKqnP1LplUQxM0nrtn881r+Moi68r0zTRCqITdd5gGU7SCw9ZzVhUPKkvK8uZVLSsep6+B+nVzPSFddPyfr/z8XiszPNMq9qV7L0CjVOy3Wh2XsnGzjlIqn5fru/dVvxdzlEWD5Ksz+S6qqC5jq+7/v2gXyouDEAL6eiDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chrome Console\"\n        title=\"Chrome Console\"\n        src=\"/static/090ff227c8ae6fb1de1707a6311489bd/b9e4f/ChromeConsole.png\"\n        srcset=\"/static/090ff227c8ae6fb1de1707a6311489bd/cf440/ChromeConsole.png 148w,\n/static/090ff227c8ae6fb1de1707a6311489bd/d2d38/ChromeConsole.png 295w,\n/static/090ff227c8ae6fb1de1707a6311489bd/b9e4f/ChromeConsole.png 590w,\n/static/090ff227c8ae6fb1de1707a6311489bd/f9b6a/ChromeConsole.png 885w,\n/static/090ff227c8ae6fb1de1707a6311489bd/179f0/ChromeConsole.png 1158w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The <code class=\"language-text\">ErrorCtrl</code> of this application exists just to throw a JavaScript <code class=\"language-text\">Error</code> with the message “thrown”.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">ErrorCtrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$scope<span class=\"token punctuation\">,</span> fef$log</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> $log <span class=\"token operator\">=</span> fef$log<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ErrorCtrl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  $log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loading'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'thrown'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And when the <code class=\"language-text\">/error</code> route is loaded, the stacktrace appears in the browser console.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2014-10-16T20:10:02.106Z [math:ErrorCtrl] loading\n2014-10-16T20:10:02.107Z [math]  Error: thrown\n    at new ErrorCtrl (http://localhost:3000/javascripts/math.js:50:9)\n    at invoke (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:3966:17)\n    at Object.instantiate (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:3977:23)\n    at http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:7281:28\n    at link (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-route.js:907:26)\n    at nodeLinkFn (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6711:13)\n    at compositeLinkFn (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6105:13)\n    at publicLinkFn (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6001:30)\n    at boundTranscludeFn (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6125:21)\n    at controllersBoundTransclude (http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6732:18) &lt;ng-view class=&quot;ng-scope&quot;&gt;</code></pre></div>\n<p>Additionally, an HTTP <code class=\"language-text\">POST</code> JSON payload is sent to the configured <code class=\"language-text\">httpURL</code> including that stacktrace and other logging fields.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"items\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"00f59ba88fe04df987bf774f0eae08c4\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"math\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2014-10-16T20:10:02.107Z\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:3000/#/error\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"level\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"messages\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"Error: thrown\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"&lt;ng-view class=\\\"ng-scope\\\">\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"stacktrace\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"new ErrorCtrl@http://localhost:3000/javascripts/math.js:50:9\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"invoke@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:3966:17\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"Object.instantiate@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:3977:23\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"{anonymous}()@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:7281:28\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"link@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-route.js:907:26\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"nodeLinkFn@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6711:13\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"compositeLinkFn@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6105:13\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"publicLinkFn@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6001:30\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"boundTranscludeFn@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6125:21\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"controllersBoundTransclude@http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js:6732:18\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On the server side, you can see the <code class=\"language-text\">$routeChange</code> events as well as the <code class=\"language-text\">ErrorCtrl</code> loading and the same “Error: thrown” message.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2014-10-16T20:10:02.097Z DEBUG [math:$rootScope.$on] $locationChangeStart\n2014-10-16T20:10:02.098Z LOG   [math:$rootScope.$on] $locationChangeSuccess  http://localhost:3000/#/unary/abs -&gt; http://localhost:3000/#/error\n2014-10-16T20:10:02.099Z DEBUG [math:$rootScope.$on] $routeChangeStart\n2014-10-16T20:10:02.104Z DEBUG [math:$rootScope.$on] $routeChangeSuccess\n00f59ba88fe04df987bf774f0eae08c4 http://localhost:3000/#/error\n2014-10-16T20:10:02.106Z DEBUG [math:ErrorCtrl] loading\n2014-10-16T20:10:02.107Z ERROR [math] Error: thrown &lt;ng-view class=&quot;ng-scope&quot;&gt;</code></pre></div>\n<p>Now that I feel this concept is workable, it’s time for a design review, including the JSON log format, and to write some unit tests before I ask teams to adopt this methodology.</p>\n<hr>\n<p><strong>Update:</strong> The early 2015 conclusion of this research is available on GitHub at <a href=\"https://github.com/hakanson/mathdemo-angularjs\">hakanson/mathdemo-angularjs</a>.</p>","frontmatter":{"title":"Extending AngularJS $log Concept","date":"October 17, 2014","tags":["javascript","angularjs","monitoring"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2014-10-17-extending-angularjs-log-concept","previous":{"fields":{"slug":"/2014-10-07-hindi-number-formatting-in-javascript"},"frontmatter":{"tags":["javascript","i18n"]}},"next":{"fields":{"slug":"/2014-11-13-c-and-net-without-windows-or-visual-studio"},"frontmatter":{"tags":["csharp","dotnet","opensource"]}}}}}