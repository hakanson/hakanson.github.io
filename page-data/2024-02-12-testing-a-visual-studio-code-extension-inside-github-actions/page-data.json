{"componentChunkName":"component---src-templates-blog-post-js","path":"/2024-02-12-testing-a-visual-studio-code-extension-inside-github-actions/","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"fafbe0d4-20fb-58af-ac38-97e78021eb9d","excerpt":"Visual Studio Code can be customized and enhanced through the Extension API, as I have done with the Cedar policy language for Visual Studio Code. Running…","html":"<p>Visual Studio Code can be customized and enhanced through the <a href=\"https://code.visualstudio.com/api\">Extension API</a>, as I have done with the <a href=\"https://marketplace.visualstudio.com/items?itemName=cedar-policy.vscode-cedar\">Cedar policy language for Visual Studio Code</a>.</p>\n<p>Running automated tests using <a href=\"https://github.com/features/actions\">GitHub Actions</a> gave me errors like these:</p>\n<blockquote>\n<p>Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are “tcp” and on UNIX “unix”)</p>\n</blockquote>\n<blockquote>\n<p>Exiting GPU process due to errors during initialization</p>\n</blockquote>\n<p>Below are select sections from my <a href=\"https://github.com/cedar-policy/vscode-cedar/blob/main/.github/workflows/build_and_test.yml\">build_and_test.yml</a> that removed these error messages.</p>\n<p>The GitHub Action is running on <code class=\"language-text\">ubuntu-latest</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</code></pre></div>\n<p>Running tests requires downloading a version of Visual Studio Code, so I called the REST API to get the latest stable version.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Find VS Code stable release version\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> code<span class=\"token punctuation\">-</span>stable\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          echo \"VSCODE_VERSION=`curl --silent https://update.code.visualstudio.com/api/releases/stable | jq -r '.[0]'`\" >> \"$GITHUB_OUTPUT\"</span></code></pre></div>\n<p>Then I used the <a href=\"https://github.com/actions/cache\">Cache action</a> to cache that download and improve workflow execution time on subsequent runs.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Cache VS Code download\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v4\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            .vscode-test</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> vscode<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.code<span class=\"token punctuation\">-</span>stable.outputs.VSCODE_VERSION <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>I don’t know much about D-Bus (short for “Desktop Bus”) other that it gave me a lot of errors.  I searched and eventually a <code class=\"language-text\">dbus-daemon</code> command that worked.  Then I found how to <a href=\"https://code.visualstudio.com/updates/v1_40#_disable-gpu-acceleration\">disable GPU acceleration</a> by adding <code class=\"language-text\">\"disable-hardware-acceleration\": true</code> to an <code class=\"language-text\">argv.json</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Test using VS Code\n        <span class=\"token comment\"># commands before `xvfb-run -a npm run test` avoid these ERROR messages:</span>\n        <span class=\"token comment\"># - Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are \"tcp\" and on UNIX \"unix\")</span>\n        <span class=\"token comment\"># - Exiting GPU process due to errors during initialization</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          export XDG_RUNTIME_DIR=/run/user/$(id -u)\n          export DBUS_SESSION_BUS_ADDRESS=unix:path=$XDG_RUNTIME_DIR/bus\n          dbus-daemon --session --address=$DBUS_SESSION_BUS_ADDRESS --nofork --nopidfile --syslog-only &amp;\n          mkdir ~/.vscode &amp;&amp; echo '{ \"disable-hardware-acceleration\": true }' > ~/.vscode/argv.json\n          xvfb-run -a npm run test</span></code></pre></div>\n<p>Now I get clean runs, and if you are reading this, I hope you do as well.</p>","frontmatter":{"title":"Testing a Visual Studio Code Extension inside GitHub Actions","description":null,"date":"February 12, 2024","tags":["vscode","github","codequality"],"canonical":null}}},"pageContext":{"slug":"/2024-02-12-testing-a-visual-studio-code-extension-inside-github-actions/","previous":{"fields":{"slug":"/2023-11-20-microsoft-certifications-no-longer-on-credly/"},"frontmatter":{"tags":["azure","certification"]}},"next":null}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}