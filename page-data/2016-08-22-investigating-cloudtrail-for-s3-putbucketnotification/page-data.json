{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016-08-22-investigating-cloudtrail-for-s3-putbucketnotification","webpackCompilationHash":"f141a48750e2a6a883f2","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"82b370f8-e041-596b-8851-e1e2b18f6a81","excerpt":"I was investigating the types of CloudTrail events that are available for S3.  However, when I was comparing Services Supported by CloudTrail API Activity…","html":"<p>I was investigating the types of CloudTrail events that are available for S3.  However, when I was comparing <a href=\"http://docs.aws.amazon.com/awscloudtrail/latest/userguide/view-cloudtrail-events-supported-services.html#view-cloudtrail-events-supported-apis-s3\">Services Supported by CloudTrail API Activity History</a> against the <a href=\"http://docs.aws.amazon.com/cli/latest/reference/s3api/\">s3api — AWS CLI 1.10.58 Command Reference</a>, I noticed something that confused me.</p>\n<p>CloudTrail will log a bucket level API event for PutBucketNotification, but the CLI has <code class=\"language-text\">s3api</code> commands for both <a href=\"http://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-notification.html\"><code class=\"language-text\">put-bucket-notification</code></a> and <a href=\"http://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-notification-configuration.html\"><code class=\"language-text\">put-bucket-notification-configuration</code></a>.  What is the difference?  Is the later not logged to CloudTrail? Digging into the documentation, I saw this description for <code class=\"language-text\">put-bucket-notification</code>:</p>\n<blockquote>\n<p>Deprecated, see the PutBucketNotificationConfiguraiton operation.</p>\n</blockquote>\n<p>I tried it out and see what got logged.  First, I created a blank bucket notification configuration file:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>  \n    <span class=\"token property\">\"TopicConfigurations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"QueueConfigurations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"LambdaFunctionConfigurations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  \n<span class=\"token punctuation\">}</span>  </code></pre></div>\n<p>Then I used the s3api CLI to put this configuration onto my S3 bucket:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws --profile saml s3api put-bucket-notification-configuration --bucket kjh-encryption-test1 --notification-configuration file://bucket-notification-configuration-blank.json</code></pre></div>\n<p>After a couple minutes, the event appears in CloudTrail as a <code class=\"language-text\">PutBucketNotification</code>. Here’s the raw JSON you see if you click “View event”:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>  \n   <span class=\"token property\">\"eventVersion\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1.03\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"userIdentity\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>  \n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AssumedRole\"</span><span class=\"token punctuation\">,</span>  \n      <span class=\"token property\">\"principalId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:kevin.hakanson@example.com\"</span><span class=\"token punctuation\">,</span>  \n      <span class=\"token property\">\"arn\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/PowerUser/kevin.hakanson@example.com\"</span><span class=\"token punctuation\">,</span>  \n      <span class=\"token property\">\"accountId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"123456789012\"</span><span class=\"token punctuation\">,</span>  \n      <span class=\"token property\">\"accessKeyId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"ASIAXXXXXXXXXXXXXXXX\"</span><span class=\"token punctuation\">,</span>  \n      <span class=\"token property\">\"sessionContext\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>  \n         <span class=\"token property\">\"attributes\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>  \n            <span class=\"token property\">\"mfaAuthenticated\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"false\"</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token property\">\"creationDate\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2016-08-23T01:58:41Z\"</span>  \n         <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  \n         <span class=\"token property\">\"sessionIssuer\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>  \n            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Role\"</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token property\">\"principalId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX\"</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token property\">\"arn\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"arn:aws:iam::123456789012:role/PowerUser\"</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token property\">\"accountId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"123456789012\"</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token property\">\"userName\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"PowerUser\"</span>  \n         <span class=\"token punctuation\">}</span>  \n      <span class=\"token punctuation\">}</span>  \n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"eventTime\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2016-08-23T02:24:27Z\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"eventSource\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"s3.amazonaws.com\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"eventName\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"PutBucketNotification\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"awsRegion\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"us-west-2\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"sourceIPAddress\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"198.179.137.232\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"userAgent\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"[aws-cli/1.10.43 Python/2.7.10 Darwin/14.5.0 botocore/1.4.33]\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"requestParameters\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>  \n      <span class=\"token property\">\"bucketName\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"kjh-encryption-test1\"</span><span class=\"token punctuation\">,</span>  \n      <span class=\"token property\">\"NotificationConfiguration\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>  \n         <span class=\"token property\">\"xmlns\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"http://s3.amazonaws.com/doc/2006-03-01/\"</span>  \n      <span class=\"token punctuation\">}</span>  \n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"responseElements\"</span><span class=\"token operator\">:</span><span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"requestID\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"BABEFFD87216E573\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"eventID\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"3fb71544-ab01-433b-94df-651b808348fe\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"eventType\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AwsApiCall\"</span><span class=\"token punctuation\">,</span>  \n   <span class=\"token property\">\"recipientAccountId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"123456789012\"</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Bonus:  If you noticed the typo above from the AWS CLI documentation, I created <a href=\"https://github.com/aws/aws-cli/issues/2127\">Issue #2127 · aws/aws-cli · GitHub</a>.</p>","frontmatter":{"title":"Investigating CloudTrail for S3 PutBucketNotification","date":"August 22, 2016","tags":["aws","cloudtrail","s3"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2016-08-22-investigating-cloudtrail-for-s3-putbucketnotification","previous":{"fields":{"slug":"/2016-08-15-how-iam-roles-become-credentials-on-ec2"},"frontmatter":{"tags":["aws","iam","security"]}},"next":{"fields":{"slug":"/2016-09-01-smaller-and-faster-data-compression-with-zstandard"},"frontmatter":{"tags":["webdev"]}}}}}