{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-01-13-hacked-by-baiduspider-and-yandexmetrika","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"08973eb5-2e12-5b82-ae36-45114a3d969e","excerpt":"Earlier this week, I was investigating the preview of AWS X-Ray – Distributed Tracing System and got quite a scare.  After I deployed my sample app to AWS…","html":"<p>Earlier this week, I was investigating the preview of <a href=\"https://aws.amazon.com/xray/\">AWS X-Ray – Distributed Tracing System</a> and got quite a scare.  After I deployed my sample app to <a href=\"https://aws.amazon.com/elasticbeanstalk/\">AWS Elastic Beanstalk</a>, I went into the AWS X-Ray Console to look at my trace data and saw more domain names listed than just the <code class=\"language-text\">dev-env.3tp23hiz9p.us-east-1.elasticbeanstalk.com</code> I was expecting - including at least one domain that is NSFW!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e528eb03fa8c0a7a13cc49446f8dd57b/4ef49/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABX0lEQVR42p1TYU+DMBTk//8n40ejxhndYJtuQ6YRKHSlDBgFypl2A0FwLr7kwr2XvOvlWozXhQn+Pkey8xAEIcIwBCGkRUAIwiA48tPX933NFRRv+jiOYdj2Btk+QpEfYNs2HMfRopxz7HkMsgvAIoaYcz1TiKJIQ3HGWMuzLIMxmz7BfnO0uhAC+SFHVVVQJWSBO/cZc7rRfV3XA3TnUkoYlFKt3Ii0VQMSEo8fJjZ0+72IcbGmjIYo9VaruyDrwfwcjG6j3JZl2S73DHccjR78U1CVugyVY9NHeYzr7S1ozn/PsMbQoapuhs2MJgxXqxuEKRt1fYy6P+s59DwPQhRtplVZQZYSspJ/ZjfxTEx8q59hkiSDDOuTi3NiqqbuEjPvpe9Q/QWiKAZv65LbfficafQcpmnaZnmJSNeMRVawgnXfoa8zFMcMLxRr3u/ENXHvTscy/J/DJbGxIGt8AZmNRR5yIgaeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"X-Ray Service Map\"\n        title=\"\"\n        src=\"/static/e528eb03fa8c0a7a13cc49446f8dd57b/fcda8/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png\"\n        srcset=\"/static/e528eb03fa8c0a7a13cc49446f8dd57b/12f09/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png 148w,\n/static/e528eb03fa8c0a7a13cc49446f8dd57b/e4a3f/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png 295w,\n/static/e528eb03fa8c0a7a13cc49446f8dd57b/fcda8/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png 590w,\n/static/e528eb03fa8c0a7a13cc49446f8dd57b/efc66/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png 885w,\n/static/e528eb03fa8c0a7a13cc49446f8dd57b/4ef49/Screen%2BShot%2B2017-01-13%2Bat%2B7.45.41%2BAM.png 890w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I got scared we had been hacked!  I started doing a nslookup on those domain names, trying to track down the IP address so I could find the EC2 instance and kill it.  All of these domains pointed to the same set of IPs and looked to be hosted by a company named wix.com that also uses AWS.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">www.allbione.com canonical name = www18.wixdns.net.  \r\nwww18.wixdns.net canonical name = premium.42.wix.com.  \r\npremium.42.wix.com canonical name = dispatchers-premium-693024781.us-east-1.elb.amazonaws.com.  \r\nName: dispatchers-premium-693024781.us-east-1.elb.amazonaws.com  \r\nAddress: 52.21.74.6  \r\nName: dispatchers-premium-693024781.us-east-1.elb.amazonaws.com  \r\nAddress: 52.72.254.231  \r\nName: dispatchers-premium-693024781.us-east-1.elb.amazonaws.com  \r\nAddress: 107.23.215.71</code></pre></div>\n<p>I couldn’t find the servers; I couldn’t figure out what was going on; I needed some help.  Luckily, I saw my boss was also working late so I started a online conversation.  We looked at the API activity history in Cloud Trail and didn’t find any evidence.  Eventually, he noticed the incoming IPs and we looked at the access logs. In addition to my Mac, we saw traffic from Baiduspider and YandexMetrika.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">172.31.11.216 - - \\[11/Jan/2017:23:51:11 +0000\\] \"GET / HTTP/1.1\" 200 13 \"-\" \"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)\" \"180.76.15.7\"  \r\n172.31.11.216 - - \\[11/Jan/2017:23:51:27 +0000\\] \"GET /?count=7 HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10\\_10\\_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36\" \"198.179.137.210\"  \r\n172.31.11.216 - - \\[11/Jan/2017:23:58:51 +0000\\] \"GET / HTTP/1.1\" 200 13 \"-\" \"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)\" \"220.181.108.113\"  \r\n172.31.11.216 - - \\[12/Jan/2017:00:01:45 +0000\\] \"GET / HTTP/1.1\" 200 13 \"-\" \"Mozilla/5.0 (compatible; YandexMetrika/2.0; +http://yandex.com/bots mtmon01i.yandex.ru)\" \"37.9.118.28\"  \r\n172.31.11.216 - - \\[12/Jan/2017:00:06:47 +0000\\] \"GET / HTTP/1.1\" 200 13 \"-\" \"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)\" \"123.125.71.97\"</code></pre></div>\n<p>Mystery solved. It appears that these spiders and bots didn’t have updated DNS records, and the external IP that AWS assigned my web app must have previously been used by the wix.com hosting platform.  They were just trying to reindex the web based on outdated info.  My web app was a victim of mistaken identity, not elite hackers from China and Russia.</p>\n<p>Because this was for a simple test, I had used <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3.html\">The Elastic Beanstalk Command Line Interface (EB CLI)</a> to make things easy and let it pick the defaults. This created a security group that allowed anyone to connect to port 80 - as you would expect for a public web site.  However, since this was only a test for me, I updated the incoming rule only to allow my IP range.  This stopped the extra log entries from being created.</p>\n<p>So, why am I posting this since getting “hacked” by a web spider doesn’t contribute to my “street cred” very much?</p>\n<ul>\n<li>A reminder that you can’t control external traffic and as soon as something appears on the internet, it will be found.  Everything from our sandbox testing to our production systems needs to understand this and plan for it.</li>\n<li>A realization that at the time I was a bit unclear of what to do next if this had been hackers.  I am going to follow up internally on this topic.</li>\n</ul>","frontmatter":{"title":"\"Hacked\" by Baiduspider and YandexMetrika","description":null,"date":"January 13, 2017","tags":["aws","xray","security","monitoring"],"canonical":null}}},"pageContext":{"slug":"/2017-01-13-hacked-by-baiduspider-and-yandexmetrika","previous":{"fields":{"slug":"/2016-12-21-my-first-published-alexa-skill-mars-rover-mission"},"frontmatter":{"tags":["alexa","javascript","vui","conference"]}},"next":{"fields":{"slug":"/2017-01-15-aws-x-ray-investigation"},"frontmatter":{"tags":["aws","xray","javascript","monitoring"]}}}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}