{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-03-20-aws-options-for-blocking-ip-addresses","webpackCompilationHash":"7d39e4954020dd9078cb","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"f94a2b1a-e0a1-550f-8661-a9a2c2fd64ce","excerpt":"While diving into BIG-IP iRules code researching HTTP to HTTPS Redirection, I ran across this snippet: Reaching out to one of the DevOps team to learn more, he…","html":"<p>While diving into BIG-IP iRules code researching <a href=\"../2018-03-13-http-to-https-redirection\">HTTP to HTTPS Redirection</a>, I ran across this snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"tcl\"><pre class=\"language-tcl\"><code class=\"language-tcl\">ltm rule APPX_BLOCK <span class=\"token punctuation\">{</span>\n    when CLIENT_ACCEPTED <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">if</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>matchclass <span class=\"token punctuation\">[</span>IP::remote_addr<span class=\"token punctuation\">]</span> <span class=\"token operator\">eq</span> APPX_BLOCK_IPs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>\n            reject\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Reaching out to one of the DevOps team to learn more, he directed me to a process document on how to block IP address in our data center.  That caused me to consider what the AWS solution to this problem look like?  Below are a couple of options.</p>\n<h2>Static Blocking</h2>\n<p>If you wanted to mimic the legacy process, you could used a Security Group and DENY access to those IPs.  However, according to <a href=\"https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Appendix_Limits.html#vpc-limits-security-groups\">Amazon VPC Limits</a>, the “Inbound or outbound rules per security group” limit is 50.</p>\n<blockquote>\n<p>You can have 50 inbound and 50 outbound rules per security group (giving a total of 100 combined inbound and outbound rules). To increase or decrease this limit, contact AWS Support — a limit change applies to both inbound and outbound rules. However, the limit for inbound or outbound rules per security group multiplied by the limit for security groups per network interface cannot exceed 250. For example, if you want to increase the limit to 100, we decrease your number of security groups per network interface to 2.</p>\n</blockquote>\n<p>Combining the low IP limit with the fact that modern hackers change IP addresses frequently, a static option isn’t very attractive.</p>\n<h2>Dynamic Blocking</h2>\n<p>An internal project has published some WAF templates that include rules which block requests from IP addresses on third-party reputation lists:</p>\n<blockquote>\n<p>This lambda function checks third-party IP reputation lists hourly for new IP ranges to block. These lists include the Spamhaus Dont Route Or Peer (DROP) and Extended Drop (EDROP) lists, the Proofpoint Emerging Threats IP list, and the Tor exit node list.</p>\n</blockquote>\n<p>This dynamically catches threats, but not necessary the IPs attacking our products.</p>\n<h2>Custom Dynamic Blocking</h2>\n<p>Amazon publishes solutions where Lambda functions monitor logs and automatically update AWS WAF rules.  One such solution is <a href=\"https://docs.aws.amazon.com/waf/latest/developerguide/tutorials-4xx-blocking.html\">Tutorial: Blocking IP Addresses That Submit Bad Requests</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad8b712c01931112e6e5dad9b147e0a4/97281/pastedImage_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.27762803234502%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACQklEQVQoz52Sy27TUBCG8zx9BZ6AHVvEhi0SGzYUsWWFCgIhIQECqVCkIhalsEGIVmoLTWmaS9vc7DiOnYtD7k0cJ3Z8ycexs2gEO0YazdH/z/znzJyJWZZFWVVxHIfQ5kHAfD6Pzq7r4vgBw1KRyvpLAsEJkrnvLeJfHlpsPB6TOEli23YktmyhoC+Kp15A27Lxl/g5/1ooGuv3+yiKwmg4xBUFHUVGevEUp9tBvFVgIrOZY/7zdVQ0qko03twGs0HXtLmxtsOnZCvigkAITiYTpsId8cLQKsdxzh/cZ6SrTGczLHvGuHRM9/NDPFHQTO2i3FkB4xTF6LNy6wPPd6qXgql0hncb76lWNPQv21TFPNtqGU+0G7bseR5Da0qt08cXLYWz7rYMZoILG5e0FqPx9LLlVq1GYm+ffquFK9rudrsoWgXDaFLVNGqCN4p56ocHGPU6dYHX1RJGox7l6LoscnTGY2vxKYNmk3ZZwez3IiCVOeHxxiqSUkDK5cgqZaT1V5SuX0UuymS+b5G5ewX1YJtsVmL12TW+xTexzMXIYs7MZSLm57izCDhOxll7e4+slEar6MjlMme/jjja+ohcUsgd7pJ+dBMtsUM+V+TJ+ipff2xiT9yF4PK3+76PpumcZs4p5AsUi0VkWSaVTLJ/GKdQEJhcIp0toKgVyuIyqSAuyeZp/NYXgstLGcbRaESv14tmGbk499ptBp3OAhdxIMZzcXHBYDDANE1qdZ3E2V70gbHlpfxfm4n1MhrNSPAPVKgqj3sq/z8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Blocking IP Addresses That Submit Bad Requests\"\n        title=\"Blocking IP Addresses That Submit Bad Requests\"\n        src=\"/static/ad8b712c01931112e6e5dad9b147e0a4/b9e4f/pastedImage_1.png\"\n        srcset=\"/static/ad8b712c01931112e6e5dad9b147e0a4/cf440/pastedImage_1.png 148w,\n/static/ad8b712c01931112e6e5dad9b147e0a4/d2d38/pastedImage_1.png 295w,\n/static/ad8b712c01931112e6e5dad9b147e0a4/b9e4f/pastedImage_1.png 590w,\n/static/ad8b712c01931112e6e5dad9b147e0a4/97281/pastedImage_1.png 742w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This type of solution is the most compelling, because it reacts to malicious traffic explicitly directed at our products.  It is also the most complex.</p>\n<p>More research is needed, so another item for the backlog.</p>","frontmatter":{"title":"AWS Options for Blocking IP Addresses","date":"March 20, 2018","tags":["aws","security","networking"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018-03-20-aws-options-for-blocking-ip-addresses","previous":{"fields":{"slug":"/2018-03-15-amazon-load-balancers-x-forwarded-headers-and-proxy-protocol-support"},"frontmatter":{"tags":["aws","http","networking"]}},"next":{"fields":{"slug":"/2018-04-09-database-credential-rotation-in-postgresql"},"frontmatter":{"tags":["aws","secretsmanager","database","security"]}}}}}