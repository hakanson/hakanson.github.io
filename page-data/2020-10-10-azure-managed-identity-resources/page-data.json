{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-10-10-azure-managed-identity-resources","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"882530fd-af72-5700-8e60-2a45af29de4d","excerpt":"As part of studying for the Azure Architect exams using Microsoft Learn, I was experimenting with Managed Identities.  Here is the definition from the What areâ€¦","html":"<p>As part of studying for the Azure Architect exams using <a href=\"https://docs.microsoft.com/en-us/learn/\">Microsoft Learn</a>, I was experimenting with Managed Identities.  Here is the definition from the <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview\">What are managed identities for Azure resources?</a> page of the Azure docs:</p>\n<blockquote>\n<p>There are two types of managed identities:</p>\n<ul>\n<li><strong>System-assigned</strong> Some Azure services allow you to enable a managed identity directly on a service instance. When you enable a system-assigned managed identity an identity is created in Azure AD that is tied to the lifecycle of that service instance. So when the resource is deleted, Azure automatically deletes the identity for you. By design, only that Azure resource can use this identity to request tokens from Azure AD.</li>\n<li><strong>User-assigned</strong> You may also create a managed identity as a standalone Azure resource. You can <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal\">create a user-assigned managed identity</a> and assign it to one or more instances of an Azure service. In the case of user-assigned managed identities, the identity is managed separately from the resources that use it.</li>\n</ul>\n</blockquote>\n<p>Using the Azure CLI, I can show the <code class=\"language-text\">kjh-mi</code> managed identity which I created as an Azure resource.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kevin@Azure:~$ az identity show <span class=\"token parameter variable\">--name</span> <span class=\"token string\">\"kjh-mi\"</span> --resource-group <span class=\"token string\">\"kjh-microsoft-learn\"</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"clientId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"a72223ed-0a1e-4683-9b4b-44bed448bccc\"</span>,\n  <span class=\"token string\">\"clientSecretUrl\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"https://control-northcentralus.identity.azure.net/subscriptions/1b877039-42c8-467f-a80b-950b770fa4ff/resourcegroups/kjh-microsoft-learn/providers/Microsoft.ManagedIdentity/userAssignedIdentities/kjh-mi/credentials?tid=01177861-2ff6-4b20-b546-49fd6cada0ec&amp;oid=8097154c-b14f-4898-928c-16ca80e12dfd&amp;aid=a72223ed-0a1e-4683-9b4b-44bed448bccc\"</span>,\n  <span class=\"token string\">\"id\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/subscriptions/1b877039-42c8-467f-a80b-950b770fa4ff/resourcegroups/kjh-microsoft-learn/providers/Microsoft.ManagedIdentity/userAssignedIdentities/kjh-mi\"</span>,\n  <span class=\"token string\">\"location\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"northcentralus\"</span>,\n  <span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"kjh-mi\"</span>,\n  <span class=\"token string\">\"principalId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"8097154c-b14f-4898-928c-16ca80e12dfd\"</span>,\n  <span class=\"token string\">\"resourceGroup\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"kjh-microsoft-learn\"</span>,\n  <span class=\"token string\">\"tags\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"tenantId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"01177861-2ff6-4b20-b546-49fd6cada0ec\"</span>,\n  <span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Microsoft.ManagedIdentity/userAssignedIdentities\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Similar to a User or Group, a managed identity is a security principal object in Azure AD.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 325px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a49debd7a71f40862472552b7d7a209/ff46a/rbac-security-principal.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAFxFAABcRQG5LWIsAAABzElEQVR42k2SyW4TQRCG58qVF+BJuIYL4kE4RQgkHoAbZ4R4AC4gsZwSCQlhgzgAUZyEJY6F97HHHseetXt6mfnQ9AQ7LVXXX3+p/qoutQdQVWXt6Effudh8JksEcRyTpilRFCGEcL7mkiRxVlUVTW3td9irL1NaR5yFhxwt3xCtU4bjEfMgYDKZ4Ps+vj9jPJnytz9gGYZbgaqybqArfTylNVgNRmMNlLXVoCox1mKtxRiznaJRKlGqQGmLMqA0aK0QQuLV+ZcLycGqcEV119xWdGV5VdwIrXPD4a+YD39iLjPtuNKmlMFTyH+4WIisEbzbHrJ/5G8HOI0Vt1sjHh3OGW+a4q8rxY23c26+D2gvC8dZs0F398jDdzvBgyBjrzXk3pcRPyPpEk9+h9xp9bn1vMvr48hx57nhfj9mf5DQk3a7gjh4RWs4dFgKgfdxvObhpy6P2xechqlLPDuZ8qDV40VnxiIxTXdlOZ8JBsuCTW7cKroLSWcm+DZKGVxq9xvck1dpSZiUXD/+2uJvLKr5AExjw1mgOJkX9FbNGvzY0PELjqeSZV5hVIEnpURcs/9xUeziGkeZIM4E66TxNZfm0uEkE2SiIMtS/gHqP6RjBc1EGAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"security principals\"\n        title=\"\"\n        src=\"/static/5a49debd7a71f40862472552b7d7a209/ff46a/rbac-security-principal.png\"\n        srcset=\"/static/5a49debd7a71f40862472552b7d7a209/12f09/rbac-security-principal.png 148w,\n/static/5a49debd7a71f40862472552b7d7a209/e4a3f/rbac-security-principal.png 295w,\n/static/5a49debd7a71f40862472552b7d7a209/ff46a/rbac-security-principal.png 325w\"\n        sizes=\"(max-width: 325px) 100vw, 325px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Using the <code class=\"language-text\">principalId</code> value of <code class=\"language-text\">8097154c-b14f-4898-928c-16ca80e12dfd</code>, I can call into the <code class=\"language-text\">directoryObjects</code> Microsoft Graph API to get the corresponding object from Azure AD.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kevin@Azure:~$ az rest <span class=\"token parameter variable\">--url</span> <span class=\"token string\">\"https://graph.microsoft.com/v1.0/directoryObjects/8097154c-b14f-4898-928c-16ca80e12dfd?\\<span class=\"token variable\">$select</span>=id,alternativeNames,appId,displayName,servicePrincipalType,servicePrincipalNames\"</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"@odata.context\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"https://graph.microsoft.com/v1.0/<span class=\"token variable\">$metadata</span>#directoryObjects(id,alternativeNames,appId,displayName,servicePrincipalType,servicePrincipalNames)/<span class=\"token variable\">$entity</span>\"</span>,\n  <span class=\"token string\">\"@odata.type\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"#microsoft.graph.servicePrincipal\"</span>,\n  <span class=\"token string\">\"alternativeNames\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"isExplicit=True\"</span>,\n    <span class=\"token string\">\"/subscriptions/1b877039-42c8-467f-a80b-950b770fa4ff/resourcegroups/kjh-microsoft-learn/providers/Microsoft.ManagedIdentity/userAssignedIdentities/kjh-mi\"</span>\n  <span class=\"token punctuation\">]</span>,\n  <span class=\"token string\">\"appId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"a72223ed-0a1e-4683-9b4b-44bed448bccc\"</span>,\n  <span class=\"token string\">\"displayName\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"kjh-mi\"</span>,\n  <span class=\"token string\">\"id\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"8097154c-b14f-4898-928c-16ca80e12dfd\"</span>,\n  <span class=\"token string\">\"servicePrincipalNames\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"a72223ed-0a1e-4683-9b4b-44bed448bccc\"</span>,\n    <span class=\"token string\">\"https://identity.azure.net/ClNzn4fxz/63fEHulvQtfB7agLtUDIkCJSx4OFAC3Tw=\"</span>\n  <span class=\"token punctuation\">]</span>,\n  <span class=\"token string\">\"servicePrincipalType\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"ManagedIdentity\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that the <code class=\"language-text\">@odata.type</code> is <code class=\"language-text\">microsoft.graph.servicePrincipal</code> and the <code class=\"language-text\">servicePrincipalType</code> has a <code class=\"language-text\">ManagedIdentity</code> value.</p>\n<p>The Azure <code class=\"language-text\">Microsoft.ManagedIdentity/userAssignedIdentities</code> resource <code class=\"language-text\">principalId</code> value of <code class=\"language-text\">8097154c-b14f-4898-928c-16ca80e12dfd</code> appears as <code class=\"language-text\">id</code>, the <code class=\"language-text\">clientId</code> value of <code class=\"language-text\">a72223ed-0a1e-4683-9b4b-44bed448bccc</code> appears as <code class=\"language-text\">appId</code>, and the <code class=\"language-text\">name</code> of <code class=\"language-text\">kjh-mi</code> maps to the <code class=\"language-text\">displayName</code> property.  The <code class=\"language-text\">alternativeNames</code> and <code class=\"language-text\">servicePrincipalNames</code> also have interesting corresponding values.</p>","frontmatter":{"title":"Azure Managed Identity Resources","description":null,"date":"October 10, 2020","tags":["azure","security","iam","cli"],"canonical":null}}},"pageContext":{"slug":"/2020-10-10-azure-managed-identity-resources","previous":{"fields":{"slug":"/2020-09-18-7-attempts-at-slide-deck-humor"},"frontmatter":{"tags":["random"]}},"next":{"fields":{"slug":"/2020-10-30-im-a-microsoft-azure-solutions-architect-expert"},"frontmatter":{"tags":["azure","architecture","certification"]}}}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}