{"componentChunkName":"component---src-templates-blog-post-js","path":"/2024-09-23-asking-claude-haiku-for-a-poem-about-my-favorite-color/","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"378db96f-8344-538c-9391-924a0199366b","excerpt":"Recently, I was working on a TypeScript code sample using @aws-sdk/client-bedrock-runtime.  Since I like to have fun with my examples, I gave Claude a role with…","html":"<p>Recently, I was working on a TypeScript code sample using <a href=\"https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-client-bedrock-runtime/\">@aws-sdk/client-bedrock-runtime</a>.  Since I like to have fun with my examples, I <a href=\"https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/system-prompts\">gave Claude a role with a system prompt</a> along with my user prompt.</p>\n<ul>\n<li><strong>System Prompt:</strong>  You must always respond in rhymes.</li>\n<li><strong>User Message:</strong>  Tell me about Kevin’s favorite color.</li>\n</ul>\n<p>Claude 3 <a href=\"https://www.anthropic.com/claude/haiku\">Haiku</a> gave me a decent response for not knowing the answer.</p>\n<blockquote>\n<p>Alas, I do not know Kevin’s favorite hue,<br>\nFor his color preference, I have no clue.<br>\nIf you could provide more details, it would be grand,<br>\nThen I could attempt to understand.</p>\n</blockquote>\n<p>How could Claude know Kevin’s favorite color is blue, and generate a poem like this?</p>\n<blockquote>\n<p>The color that Kevin adores,<br>\nIs a lovely shade of blue, nothing more.<br>\nThis tranquil tone, so serene and true,<br>\nBrings him joy, through and through.</p>\n</blockquote>\n<p>Claude can integrate with external tools through <a href=\"https://docs.anthropic.com/en/docs/build-with-claude/tool-use\">tool use (function calling)</a>.  The JSON below defines a <code class=\"language-text\">get_favorite_color</code> tool that indicates it can “Get a person’s favorite color” given the <code class=\"language-text\">person</code>’s name.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"get_favorite_color\"</span><span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">:</span> <span class=\"token string\">\"Get a person's favorite color\"</span><span class=\"token punctuation\">,</span>\n  inputSchema<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    json<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n      properties<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        person<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          type<span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n          description<span class=\"token operator\">:</span> <span class=\"token string\">\"The person's name\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      required<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"person\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now that same prompt will cause Claude to request <code class=\"language-text\">toolUse</code> of <code class=\"language-text\">get_favorite_color</code> for <code class=\"language-text\">person</code> <strong>Kevin</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"toolUse\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"input\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"person\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Kevin\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"get_favorite_color\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"toolUseId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tooluse_Yg0aXKPfQv6ypSmtdJF8pw\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>My favorite color is <strong>blue</strong>, and odds are that yours is as well (see <a href=\"https://today.yougov.com/international/articles/12335-why-blue-worlds-favorite-color\">Why is blue the world’s favorite color?</a>).  Therefore, let’s hard code the response.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">command<span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  role<span class=\"token operator\">:</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span>\n  content<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      toolResult<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        toolUseId<span class=\"token operator\">:</span> toolUse<span class=\"token punctuation\">.</span>toolUseId<span class=\"token punctuation\">,</span>\n        content<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> json<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>favorite_color<span class=\"token operator\">:</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The sample-quality code is below - filled with <code class=\"language-text\">console.log</code>, always assumes this <code class=\"language-text\">toolUse</code>, and doesn’t know how to find everyone’s favorite color.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  BedrockRuntimeClient<span class=\"token punctuation\">,</span>\n  ConverseCommand<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@aws-sdk/client-bedrock-runtime\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BedrockRuntimeClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> region<span class=\"token operator\">:</span> <span class=\"token string\">\"us-west-2\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> modelId <span class=\"token operator\">=</span> <span class=\"token string\">\"anthropic.claude-3-haiku-20240307-v1:0\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> systemPrompt <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> <span class=\"token string\">\"You must always respond in rhymes.\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> userMessage <span class=\"token operator\">=</span> <span class=\"token string\">\"Tell me about Kevin's favorite color.\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> conversation <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    role<span class=\"token operator\">:</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span>\n    content<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> userMessage <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> toolSpec <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"get_favorite_color\"</span><span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">:</span> <span class=\"token string\">\"Get a person's favorite color\"</span><span class=\"token punctuation\">,</span>\n  inputSchema<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    json<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n      properties<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        person<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          type<span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n          description<span class=\"token operator\">:</span> <span class=\"token string\">\"The person's name\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      required<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"person\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> command <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConverseCommand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  modelId<span class=\"token punctuation\">,</span>\n  messages<span class=\"token operator\">:</span> conversation<span class=\"token punctuation\">,</span>\n  system<span class=\"token operator\">:</span> systemPrompt<span class=\"token punctuation\">,</span>\n  toolConfig<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    tools<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        toolSpec<span class=\"token operator\">:</span> toolSpec<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  inferenceConfig<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> maxTokens<span class=\"token operator\">:</span> <span class=\"token number\">512</span><span class=\"token punctuation\">,</span> temperature<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> topP<span class=\"token operator\">:</span> <span class=\"token number\">0.9</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> responseText <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  command<span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> toolUse <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>toolUse<span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>toolUse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  command<span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    role<span class=\"token operator\">:</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span>\n    content<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        toolResult<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          toolUseId<span class=\"token operator\">:</span> toolUse<span class=\"token punctuation\">.</span>toolUseId<span class=\"token punctuation\">,</span>\n          content<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> json<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>favorite_color<span class=\"token operator\">:</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  responseText <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ERROR: Can't invoke '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>modelId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'. Reason: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Asking Claude Haiku for a poem about my favorite color","description":null,"date":"September 23, 2024","tags":["genai","aws","javascript"],"canonical":null}}},"pageContext":{"slug":"/2024-09-23-asking-claude-haiku-for-a-poem-about-my-favorite-color/","previous":{"fields":{"slug":"/2024-05-03-rds-iam-authentication-and-mysql-error-1045/"},"frontmatter":{"tags":["aws","iam","database","cloud9"]}},"next":{"fields":{"slug":"/2024-10-04-asking-claude-haiku-to-redefine-ab-testing/"},"frontmatter":{"tags":["genai"]}}}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}