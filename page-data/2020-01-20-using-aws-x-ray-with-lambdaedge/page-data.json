{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-01-20-using-aws-x-ray-with-lambdaedge","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"f96f0d20-c928-573a-ab0c-8c1ede2dd31b","excerpt":"One of my original Lambda@Edge functions was still running on an old Node.js runtime, which I needed to update.  That function dynamically generated images of a…","html":"<p>One of my original Lambda@Edge functions was still running on an old Node.js runtime, which I needed to update.  That function dynamically generated images of a United States map with various states shaded based on the filename.  </p>\n<p><code class=\"language-text\">https://redacted.cloudfront.net/license-plate-zone/dynamic/usmap.MN.small.jpg</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe6fcec49e1284752a7dc71d3d408859/80e3c/usmap.MN.small.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB6z1SUUL/AP/EABoQAAICAwAAAAAAAAAAAAAAAAERAAIQEjH/2gAIAQEAAQUCZYsYOKaDH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAMBAQEAAAAAAAAAAAAAAAABESEQQf/aAAgBAQABPyFqbRJ66W6fo7t3p//aAAwDAQACAAMAAAAQFM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMUFRcf/aAAgBAQABPxDaY25FTU8jO+6o6IC7W/ICba+3Dgn/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"United States map with Minnesota highlighted\"\n        title=\"United States map with Minnesota highlighted\"\n        src=\"/static/fe6fcec49e1284752a7dc71d3d408859/1c72d/usmap.MN.small.jpg\"\n        srcset=\"/static/fe6fcec49e1284752a7dc71d3d408859/a80bd/usmap.MN.small.jpg 148w,\n/static/fe6fcec49e1284752a7dc71d3d408859/1c91a/usmap.MN.small.jpg 295w,\n/static/fe6fcec49e1284752a7dc71d3d408859/1c72d/usmap.MN.small.jpg 590w,\n/static/fe6fcec49e1284752a7dc71d3d408859/80e3c/usmap.MN.small.jpg 720w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This image was created from a base SVG, which was parsed and the <code class=\"language-text\">fill</code> color set for each state.  This was subsequently converted into either a JPEG or PNG.  When I first authored this function, I used the X-Ray subsegment functionality to understand the duration of each of these steps.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>AWSXRay<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> subsegment <span class=\"token operator\">=</span> AWSXRay<span class=\"token punctuation\">.</span><span class=\"token function\">getSegment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addNewSubsegment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'generateSVG'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, after updating the code and trying to “Deploy to Lambda@Edge”…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e851d19534f7fc92194da854f7304ee/eb390/deploy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.513513513513516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABG0lEQVQY012R2Y7CMAxF+//fN0LDAClt0yWrE8ddoWWM+lKIrizLOrblm6xumntZVrK+F2VRclZhSvM8T9Mk66YoKy6KXDCTMyElh5sQHDttMm0sy1jXtkorY60LMWKiROS879S75IFfcM4zprV9Qx5CxCyvCu2NASvKu+xqQGBC5EWnNA9t2nYYxnEZaSJIwYJtTYcDAgXsMYsThMGz3sno4wi8VVaSd1Lfr+u6bVsYAAa7YzujQquDytIcj6IFiUgpbYzls1+v17qtNOMXxlMc2syTPQp6FxOyVcqYZVmez+fj8QA+/xNzZC03B4xHQYyd1j+n0/lyud7E7/lPNg18MrsiYoaYjkqJQgj8f2wVOzrNC/v1xezi5n8ZVL6brpxEDAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Deploy to Lambda@Edge&quot;\"\n        title=\"Deploy to Lambda@Edge&quot;\"\n        src=\"/static/0e851d19534f7fc92194da854f7304ee/fcda8/deploy.png\"\n        srcset=\"/static/0e851d19534f7fc92194da854f7304ee/12f09/deploy.png 148w,\n/static/0e851d19534f7fc92194da854f7304ee/e4a3f/deploy.png 295w,\n/static/0e851d19534f7fc92194da854f7304ee/fcda8/deploy.png 590w,\n/static/0e851d19534f7fc92194da854f7304ee/efc66/deploy.png 885w,\n/static/0e851d19534f7fc92194da854f7304ee/eb390/deploy.png 935w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>…I saw this “X-Ray is not supported” error message:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a01888ad23d9b01cb347a13c132176d/0d1a4/xray-not-supported.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABi0lEQVQoz4WRSU/kMBCF89v5FwxcmLnPgQMnLgghNQcuo15YmiStzuY4sR3bcbymqQ4SMDTMPH0qlWzZfq8c4aZZr5+zvIiTzerhMU43xlptzIT9jkFrIWUkpeg4V0JI3nFKRMeCtYC3xhv9D6zWkeNM3d3k98t0Od+sFuliXq6fsoeVRGXoqGfkEFgfMHKsjawUNnkUqOSookUuauRFZzmDGiT/jmlXgG2JMEZVpZXyFuJqqDtQCKP374TP7MYQEakRbvI8L8qyKKttlhHK+l7BwHb/U0R5j2rc4IZSRhmD2jTQU62Nm+S9DyF8fVgIgVB9dX19cnp69vPX8Y+T2ewWfgs+o1dKDXsZY8dxtM59PgwxrdG4rtMk2W63cRwTQqbIfwksGGPgChhFAC/eQRfRTiZFnZcwsgoyl1WVZXmSpGCnaVsAIrRtCzdOcRglBDPZab9/2TgPzaDNq0eleg0aNEQ9DLl/Fypeu/mFz/5EYMa/TWaSm4CEkPwjsMIFJ0LJxSU7P5J3v18A29Sq78qy8QAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"X-Ray is not Support\"\n        title=\"X-Ray is not Support\"\n        src=\"/static/8a01888ad23d9b01cb347a13c132176d/fcda8/xray-not-supported.png\"\n        srcset=\"/static/8a01888ad23d9b01cb347a13c132176d/12f09/xray-not-supported.png 148w,\n/static/8a01888ad23d9b01cb347a13c132176d/e4a3f/xray-not-supported.png 295w,\n/static/8a01888ad23d9b01cb347a13c132176d/fcda8/xray-not-supported.png 590w,\n/static/8a01888ad23d9b01cb347a13c132176d/efc66/xray-not-supported.png 885w,\n/static/8a01888ad23d9b01cb347a13c132176d/0d1a4/xray-not-supported.png 1036w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Sure enough, when I look at the <a href=\"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/lambda-requirements-limits.html#lambda-requirements-lambda-function-configuration\">Lambda Function Supported Runtimes and Configuration </a> I see this lack of X-Ray support explicitly listed.</p>\n<blockquote>\n<ul>\n<li>AWS X-Ray is not supported.</li>\n</ul>\n</blockquote>\n<p>How was it working for me before?  What had I done differently, or was this a feature which has been disabled for new deployments?  Instead of using the AWS Console, I used the AWS CLI <a href=\"https://docs.aws.amazon.com/cli/latest/reference/lambda/publish-version.html?highlight=edge\">publish-version</a> command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws lambda publish-version --function-name LicensePlateZone-CloudFront-OriginRequest</code></pre></div>\n<p>I then used the AWS Console to update the Behavior on this CloudFront Distribution to specify the version as <code class=\"language-text\">:2</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/779fc3c6cb5b90fe4523adbf5acb0ca3/264eb/cloudfront-behavior.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABJ0AAASdAHeZh94AAAApElEQVQY03VQ7Q6DIBDj/Z9wf9ANiIpfiAokinZwCcmybE0ajgvtXWFt2yKz6zoopaC1xjfu+yb+g5QSx3FQzZxzKNy2DSGEVO8YxxHzPFOv4Loi9ZbFJC6YpgkxRtIUsF8TQ/AYhoFMjTE4z5OE2bCk0X1Pp7UW3vs0eIWxK1iJ8xnL7TuqqgLnHHX9JGHeLD0gw/w1fTJsmobuQggoKfDgL7wBQiA0AlKjd44AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda Function Associates\"\n        title=\"Lambda Function Associates\"\n        src=\"/static/779fc3c6cb5b90fe4523adbf5acb0ca3/fcda8/cloudfront-behavior.png\"\n        srcset=\"/static/779fc3c6cb5b90fe4523adbf5acb0ca3/12f09/cloudfront-behavior.png 148w,\n/static/779fc3c6cb5b90fe4523adbf5acb0ca3/e4a3f/cloudfront-behavior.png 295w,\n/static/779fc3c6cb5b90fe4523adbf5acb0ca3/fcda8/cloudfront-behavior.png 590w,\n/static/779fc3c6cb5b90fe4523adbf5acb0ca3/264eb/cloudfront-behavior.png 867w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In CloudFront Monitoring, when you look at the “Lambda@edge function metrics” section, it indicates in which regions the functions are invoked.</p>\n<blockquote>\n<p>Lambda@Edge functions are triggered in Regions close to your end users.</p>\n<p>The metrics on this page provide an aggregate view of different Regions in which the Lambda@Edge function executed.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a9667bef8bb83639703c7fd4af87d48/baaa6/cloudfront-monitoring.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABJ0AAASdAHeZh94AAABsklEQVQ4y61UaY/rIAzM//+Lq967SXNfhCTkmPU4Tdqt9N6Htkgjg8GDMTBeaUdcS4dhAqybEVYOpp8xzxO6rkPbtuj7fut33b0/zzPWxi7HXlXXyPMccRzD932112u4+ZIkQRAEyLJMfBmiKNJ1YRgiTVOdL4qClErs0XE5n3E4HHA+nXCW/uVywff3jwYu48Xn+z9qd7sdTqcj9vs9jscjYtmkc6OcUjK01qKqKkVZlqglY2OMWKPWNItlxgTnm6bRrHg6jZW4yvZo+xFeK/VohNRKTVYYCahJ+gD6Hv3reIOpdTOPA9YlFLBm7BeyIzfhXHPDGvg8vvusxni8MRaYhV8uJNAsX23eOI4gnhufwCvwhmHQNzVN08skfwklOx77o4Qfz3AjfKN2f2qoZM4CvXkb9wzHAfM0vg19NvxatEx5evfIz4QfuRQKxPq4P3IpzvX//EqPIrr5/rNOj0yVoFhSmamP1spnryv1OecQJdEiCDcZG27reJmUrzwvNDbLUhEHNyDJShGGSPWQalMWOdpwp6JB39f1SxU7FWQy34jIRiIkJE/SBHEgWpkWyvELvtoZafvf+UAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CloudFront &gt; Monitoring &gt; LicensePlateZone-CloudFront-OriginRequest:2\"\n        title=\"CloudFront &gt; Monitoring &gt; LicensePlateZone-CloudFront-OriginRequest:2\"\n        src=\"/static/3a9667bef8bb83639703c7fd4af87d48/fcda8/cloudfront-monitoring.png\"\n        srcset=\"/static/3a9667bef8bb83639703c7fd4af87d48/12f09/cloudfront-monitoring.png 148w,\n/static/3a9667bef8bb83639703c7fd4af87d48/e4a3f/cloudfront-monitoring.png 295w,\n/static/3a9667bef8bb83639703c7fd4af87d48/fcda8/cloudfront-monitoring.png 590w,\n/static/3a9667bef8bb83639703c7fd4af87d48/baaa6/cloudfront-monitoring.png 813w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>AWS X-Ray is supported in Ohio (us-east-2) where this executed…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e031cc1b5d07282fde5f97db1f874114/00172/xray-regions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.513513513513512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABJ0AAASdAHeZh94AAAAlUlEQVQI1z2P3Q6DIAyFff839GbE6IR5YUB+BeZZ282RNJz2pN+BYds28Nn3Hc91xXVdiDGi9zdSSsg5I4SAaZpQSkHwXmasj+NAaw1KPaQ3xmDQWv+B8zwLkAGtd7o9vP+WUkoCnHPis7bWijeOI8FeWGh/WGyEC5GSKs7zlPRMaZEWODVRz/NaK8rt/154a4byr7g+O23mkDEmuZAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS X-Ray Regions\"\n        title=\"AWS X-Ray Regions\"\n        src=\"/static/e031cc1b5d07282fde5f97db1f874114/fcda8/xray-regions.png\"\n        srcset=\"/static/e031cc1b5d07282fde5f97db1f874114/12f09/xray-regions.png 148w,\n/static/e031cc1b5d07282fde5f97db1f874114/e4a3f/xray-regions.png 295w,\n/static/e031cc1b5d07282fde5f97db1f874114/fcda8/xray-regions.png 590w,\n/static/e031cc1b5d07282fde5f97db1f874114/efc66/xray-regions.png 885w,\n/static/e031cc1b5d07282fde5f97db1f874114/00172/xray-regions.png 1044w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>..and my code dynamically detects X-Ray support and will <code class=\"language-text\">console.log</code> the <code class=\"language-text\">awsRequestId</code> to assist my future debugging.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">AWS_XRAY_DAEMON_ADDRESS</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> segmentName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span>_HANDLER <span class=\"token operator\">||</span> <span class=\"token string\">'index.handler'</span><span class=\"token punctuation\">;</span>\n        subsegment <span class=\"token operator\">=</span> AWSXRay<span class=\"token punctuation\">.</span><span class=\"token function\">getSegment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addNewSubsegment</span><span class=\"token punctuation\">(</span>segmentName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        subsegment<span class=\"token punctuation\">.</span><span class=\"token function\">addMetadata</span><span class=\"token punctuation\">(</span><span class=\"token string\">'event'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        subsegment<span class=\"token punctuation\">.</span><span class=\"token function\">addMetadata</span><span class=\"token punctuation\">(</span><span class=\"token string\">'context'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>awsRequestId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            subsegment<span class=\"token punctuation\">.</span><span class=\"token function\">addAnnotation</span><span class=\"token punctuation\">(</span><span class=\"token string\">'awsRequestId'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">.</span>awsRequestId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">AWS X-Ray filter:  Annotation.awsRequestId = \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>context<span class=\"token punctuation\">.</span>awsRequestId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>When I go to <code class=\"language-text\">CloudWatch &gt; Log Groups &gt; /aws/lambda/us-east-1.LicensePlateZone-CloudFront-OriginRequest</code> in Ohio, I can just copy that X-Ray filter expression…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2020-01-20T04:25:45.932Z\tc80d37f9-1805-4233-8ca3-b0f86d73cd02\tINFO\tAWS X-Ray filter:  Annotation.awsRequestId = &quot;c80d37f9-1805-4233-8ca3-b0f86d73cd02&quot;</code></pre></div>\n<p>…and use to find the <code class=\"language-text\">Trace</code>.  Here is the <code class=\"language-text\">Timeline</code> for that request with a timing breakdown for <code class=\"language-text\">generateSVG</code> and <code class=\"language-text\">generateImage</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c83290017aed233adcd5d5db65ec2bb/236d7/xray-timeline.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.324324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABJ0AAASdAHeZh94AAAA6ElEQVQY02WPXU/DIBiF+///jB/ZlSZ65e10F3bNdqOxQEvL6Aes0kGPL5iYzJI8ObwEnhwyUVVo2/YKKSU453/IusKpqdFIuispaV4jUmZKKQghwBhLWZZlEg7DAGMtLt6Ba4vth0LBe+x5t6IgctbhUPXItNZomiZJYlbUOJ455zCMI+w8kTQgJ9ntK8Nmx3H/tuZmy/BybJEZY5IohIC4lmVJGecTidW5T/OXMrijh5udwMN7jedC4mn/S9w/5jU+lUU2Uov47f9C7z26voeeBoQlUEuPab7ge/YYpxnauis6gukzfgBArHXJ4fJklQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS X-Ray Timeline\"\n        title=\"AWS X-Ray Timeline\"\n        src=\"/static/3c83290017aed233adcd5d5db65ec2bb/fcda8/xray-timeline.png\"\n        srcset=\"/static/3c83290017aed233adcd5d5db65ec2bb/12f09/xray-timeline.png 148w,\n/static/3c83290017aed233adcd5d5db65ec2bb/e4a3f/xray-timeline.png 295w,\n/static/3c83290017aed233adcd5d5db65ec2bb/fcda8/xray-timeline.png 590w,\n/static/3c83290017aed233adcd5d5db65ec2bb/efc66/xray-timeline.png 885w,\n/static/3c83290017aed233adcd5d5db65ec2bb/c83ae/xray-timeline.png 1180w,\n/static/3c83290017aed233adcd5d5db65ec2bb/236d7/xray-timeline.png 1486w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Also, some of the <code class=\"language-text\">Raw data</code> JSON for that <code class=\"language-text\">Trace</code>, which shows the <code class=\"language-text\">request_id</code> and <code class=\"language-text\">resource_arn</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">    <span class=\"token property\">\"Document\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"48105c4f14533917\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"us-east-1.LicensePlateZone-CloudFront-OriginRequest\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"start_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1579494345.905</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"end_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1579494346.164</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"http\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"response\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"aws\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"request_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"c80d37f9-1805-4233-8ca3-b0f86d73cd02\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"trace_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1-5e252bc9-e3c78f382891b2ccf6c99a18\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"origin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AWS::Lambda\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"resource_arn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:lambda:us-east-2:0123456789012:function:us-east-1.LicensePlateZone-CloudFront-OriginRequest:2\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This shows that when CloudFront invokes a Lambda@Edge function in an AWS Region that supports AWS X-Ray, it works as expected.  However, this still might not mean it is “supported” by AWS, so use at your own risk.</p>","frontmatter":{"title":"Using AWS X-Ray with Lambda@Edge","description":null,"date":"January 20, 2020","tags":["aws","xray","cloudfront","monitoring"],"canonical":null}}},"pageContext":{"slug":"/2020-01-20-using-aws-x-ray-with-lambdaedge","previous":{"fields":{"slug":"/2020-01-08-setting-subscription-used-inside-azure-cloud-shell"},"frontmatter":{"tags":["azure","cli","powershell","cloudshell"]}},"next":{"fields":{"slug":"/2020-02-03-aws-ux-issues-when-under-load"},"frontmatter":{"tags":["aws","ux","codequality","random"]}}}},"staticQueryHashes":["2589769190","3567236516"]}