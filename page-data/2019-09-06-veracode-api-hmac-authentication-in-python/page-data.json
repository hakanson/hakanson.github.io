{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-09-06-veracode-api-hmac-authentication-in-python","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"678a9670-cd02-5fed-838d-03c500d671a1","excerpt":"Back on 26 August 2019, I created a GitHub issue on veracode-python-hmac-example since it didn’t work with Python 3.7.  I also reached out to Veracode Support…","html":"<p>Back on 26 August 2019, I created a <a href=\"https://github.com/ctcampbell/veracode-python-hmac-example/issues/1\">GitHub issue</a> on <a href=\"https://github.com/ctcampbell/veracode-python-hmac-example\">veracode-python-hmac-example</a> since it didn’t work with Python 3.7.  I also reached out to Veracode Support who replied right away with a compatible <code class=\"language-text\">.whl</code> file.  Today I learned that the <a href=\"https://pypi.org/project/veracode-api-signing/\">Veracode API Signing</a> Library is now available on PyPI for HMAC authentication.</p>\n<p>As a test, I wanted to write some Python code for <a href=\"https://help.veracode.com/reader/LMv_dtSHyb7iIxAQznC~9w/b94PkyMxvs8cz9nxt4rwVA\">getapplist.do</a> to mimic this usage of the Java based CLI.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> ~/.veracode/VeracodeJavaAPI.jar <span class=\"token punctuation\">\\</span>\r\n  <span class=\"token parameter variable\">-vid</span> <span class=\"token punctuation\">[</span>redacted<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">\\</span>\r\n  <span class=\"token parameter variable\">-vkey</span> <span class=\"token punctuation\">[</span>redacted <span class=\"token punctuation\">\\</span>\r\n  <span class=\"token parameter variable\">-action</span> getapplist</code></pre></div>\n<p>I was able to run this code and get the same result from the <a href=\"https://help.veracode.com/reader/LMv_dtSHyb7iIxAQznC~9w/pd_p6JjB9PcDNH3GzWF5Ag\">Veracode XML API</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> sys\r\n<span class=\"token keyword\">import</span> requests\r\n<span class=\"token keyword\">from</span> veracode_api_signing<span class=\"token punctuation\">.</span>plugin_requests <span class=\"token keyword\">import</span> RequestsAuthPluginVeracodeHMAC\r\n\r\nVERACODE_API_URL <span class=\"token operator\">=</span> <span class=\"token string\">'https://analysiscenter.veracode.com/api/5.0/'</span>\r\n\r\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\r\n\r\n    result <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>VERACODE_API_URL <span class=\"token operator\">+</span> <span class=\"token string\">\"getapplist.do\"</span><span class=\"token punctuation\">,</span> \r\n                           auth <span class=\"token operator\">=</span> RequestsAuthPluginVeracodeHMAC<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \r\n                           data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"include_user_info\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span></code></pre></div>\n<p>This works because the Veracode API Key and Key Secret are located in my <code class=\"language-text\">~/.veracode/credentials</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> ~/.veracode/credentials \r\n<span class=\"token punctuation\">[</span>default<span class=\"token punctuation\">]</span>\r\nveracode_api_key_id <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>redacted<span class=\"token punctuation\">]</span>\r\nveracode_api_key_secret <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>redacted<span class=\"token punctuation\">]</span></code></pre></div>\n<p>If you prefer the newer JSON based <a href=\"https://help.veracode.com/reader/LMv_dtSHyb7iIxAQznC~9w/gvZeRo~jgxY0DDN~~KfRkw\">Veracode REST APIs</a>, the same HMAC authentication works.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\r\n<span class=\"token keyword\">import</span> sys\r\n<span class=\"token keyword\">import</span> requests\r\n<span class=\"token keyword\">from</span> veracode_api_signing<span class=\"token punctuation\">.</span>plugin_requests <span class=\"token keyword\">import</span> RequestsAuthPluginVeracodeHMAC\r\n\r\napi_base <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.veracode.com/appsec/v1\"</span>\r\n\r\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\r\n\r\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n        response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>api_base <span class=\"token operator\">+</span> <span class=\"token string\">\"/applications\"</span><span class=\"token punctuation\">,</span>\r\n                                auth<span class=\"token operator\">=</span>RequestsAuthPluginVeracodeHMAC<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n                                params<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"size\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"500\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">except</span> requests<span class=\"token punctuation\">.</span>RequestException <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\r\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">if</span> response<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> indent<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now it’s time to explore some more Veracode APIs and add some security automation to my pipelines.</p>","frontmatter":{"title":"Veracode API HMAC Authentication in Python","description":null,"date":"September 6, 2019","tags":["security","codequality","python"],"canonical":null}}},"pageContext":{"slug":"/2019-09-06-veracode-api-hmac-authentication-in-python","previous":{"fields":{"slug":"/2019-08-21-using-the-jfrog-artifactory-cli-with-api-keys-or-access-tokens"},"frontmatter":{"tags":["devops","cli","security"]}},"next":{"fields":{"slug":"/2019-10-25-aws-alb-lambda-function-targets-and-multi-value-headers"},"frontmatter":{"tags":["aws","http","python"]}}}},"staticQueryHashes":["2589769190","97908498"],"slicesMap":{}}