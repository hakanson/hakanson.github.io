{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016-07-20-zipkin-js-investigation-part-2","webpackCompilationHash":"aaf2e98adf17fa9c33ba","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"6149d67e-f684-5a00-aaa5-5a67a4909e2a","excerpt":"The continuing story from my Zipkin JS Investigation My zipkin-js issue was fixed a couple days ago when zipkin-js/packages/zipkin-transport-http landed, so I…","html":"<p>The continuing story from my <a href=\"../2016-06-10-zipkin-js-investigation\">Zipkin JS Investigation</a></p>\n<p>My zipkin-js <a href=\"https://github.com/openzipkin/zipkin-js/issues/15\">issue</a> was fixed a couple days ago when <a href=\"https://github.com/openzipkin/zipkin-js/tree/master/packages/zipkin-transport-http\">zipkin-js/packages/zipkin-transport-http</a> landed, so I decided to revisit my test project and see how it works.</p>\n<p>I updated my <code class=\"language-text\">app.js</code> to use <code class=\"language-text\">BatchRecorder</code> and <code class=\"language-text\">HttpLogger</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>Tracer<span class=\"token punctuation\">,</span> ExplicitContext<span class=\"token punctuation\">,</span> BatchRecorder<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zipkin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>HttpLogger<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zipkin-transport-http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n<span class=\"token keyword\">const</span> ctxImpl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExplicitContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">const</span> recorder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BatchRecorder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>  \n  logger<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>  \n    endpoint<span class=\"token punctuation\">:</span> <span class=\"token string\">'http://localhost:9411/api/v1/spans'</span>  \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">const</span> tracer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Tracer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>ctxImpl<span class=\"token punctuation\">,</span> recorder<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </code></pre></div>\n<p>Then using instructions from <a href=\"http://zipkin.io/pages/quickstart.html\">Quickstart · OpenZipkin</a>, I ran a docker command to get started, …</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker run -d -p <span class=\"token number\">9411</span>:9411 openzipkin/zipkin</code></pre></div>\n<p>… ran my recursive service code, …</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 343px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/97a0de583cde0bb7d4a2f0bbb764e199/f2ae8/pastedImage_24.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.24198250728863%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4ElEQVQY0z2Q226DMAyGef83o8vWUSHCISEJOdCuQl0nDkJ0+ufkYheWLfv350PWdR2apkmW5zmcc7jfv2CMBuccbdtCCAGlFKTsMQwDvPdJN4aA5/MHy7Jgnufks7rmKMsSVVWBMZaE0zQRoEdRFCkvhIR1NkHHccRgLeksAoG3bcNxHNj3Heu6Ioti7x3ipnGyJ2AUxpzRBtfb7X+zK8GiOarFvhB88kLKdNHj8Y3sdGLUqFHzCpfiQgVDAAnZS7A3ho5g8R2f5zO00hA0WBLknX3QOxoo0sdLYvx6/eIPA74iJB+VlTEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"browser screenshot\"\n        title=\"browser screenshot\"\n        src=\"/static/97a0de583cde0bb7d4a2f0bbb764e199/f2ae8/pastedImage_24.png\"\n        srcset=\"/static/97a0de583cde0bb7d4a2f0bbb764e199/cf440/pastedImage_24.png 148w,\n/static/97a0de583cde0bb7d4a2f0bbb764e199/d2d38/pastedImage_24.png 295w,\n/static/97a0de583cde0bb7d4a2f0bbb764e199/f2ae8/pastedImage_24.png 343w\"\n        sizes=\"(max-width: 343px) 100vw, 343px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>… and looked in zipkin to see the result:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c58787a957cd5b96305f3f20441aec8/b5f89/pastedImage_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.895662368112543%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAw0lEQVQI1z2OQU7DMBBFcxbOyI5bgMQpEAdAcAAQYoXS0kKEoDRO08TUsXEzsf0wWTDS18z8J/2Z4qZquVrUvDTfGDNgnMdLQLUdzo9IhF3XZ2nyiEyBfa+xP37ezWBp9j3HKWXvSHFycUdxds3l/StMQvles/xo+Ows28PIRvu5KyOslOF5o/Nxy2rnWKiBdetmrp0gIVGcP1Sc3pY81Qf+SkJgFGHKn8SUiDExhTizN6V5XH/l0J5lDitrQ9Xafw6JX46q35nQqEhgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Zipkin trace\"\n        title=\"Zipkin trace\"\n        src=\"/static/0c58787a957cd5b96305f3f20441aec8/b9e4f/pastedImage_0.png\"\n        srcset=\"/static/0c58787a957cd5b96305f3f20441aec8/cf440/pastedImage_0.png 148w,\n/static/0c58787a957cd5b96305f3f20441aec8/d2d38/pastedImage_0.png 295w,\n/static/0c58787a957cd5b96305f3f20441aec8/b9e4f/pastedImage_0.png 590w,\n/static/0c58787a957cd5b96305f3f20441aec8/b5f89/pastedImage_0.png 853w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"Zipkin JS Investigation (Part 2)","date":"July 20, 2016","tags":["javascript","api","monitoring"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2016-07-20-zipkin-js-investigation-part-2","previous":{"fields":{"slug":"/2016-07-20-categorizing-information-security-topics"},"frontmatter":{"tags":["security"]}},"next":{"fields":{"slug":"/2016-07-29-net-zipkin-investigation-medidatazipkintracermodule"},"frontmatter":{"tags":["dotnet","api","monitoring"]}}}}}