{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-01-08-setting-subscription-used-inside-azure-cloud-shell","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"5b698e4a-ddf0-5d23-8463-cb093846169d","excerpt":"This week I am attending some Azure Architect training, listening to some lectures, and doing some labs.  The course includes Azure credits provided as an Azure…","html":"<p>This week I am attending some Azure Architect training, listening to some lectures, and doing some labs.  The course includes Azure credits provided as an Azure Sponsorships subscription, which meant I don’t need to use any of my monthly MSDN credits - unless I do something wrong - which I did.</p>\n<p>When I first set up <a href=\"https://shell.azure.com/\">Azure Cloud Shell</a> it used my oldest subscription - so old that it includes “Windows Azure” in the name and was activated in 2014.</p>\n<blockquote>\n<p>Windows Azure  MSDN - Visual Studio Premium</p>\n</blockquote>\n<p>My <code class=\"language-text\">cloud-shell-storage-eastus</code> is in that subscription, and when I log into the Azure Cloud Shell, it is the default subscription for any resource groups I create.  I realized this after creating some things, but not before too long.  I learned is you can set the active subscription from inside the Azure Cloud Shell using both the Azure CLI and PowerShell.</p>\n<p><a href=\"https://docs.microsoft.com/en-us/powershell/module/az.accounts/get-azcontext?view=azps-3.3.0\">Get-AzContext</a> and <a href=\"https://docs.microsoft.com/en-us/powershell/module/az.accounts/get-azsubscription?view=azps-3.3.0\">Get-AzSubscription</a> give us some useful information, including the subscription identifiers.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Azure:<span class=\"token operator\">/</span>\n<span class=\"token function\">PS</span> Azure:\\> <span class=\"token function\">Get-AzContext</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>Property Name<span class=\"token punctuation\">,</span> Subscription<span class=\"token punctuation\">,</span> Tenant <span class=\"token punctuation\">|</span> <span class=\"token function\">Format-List</span>\n\nName               : Windows Azure  MSDN <span class=\"token operator\">-</span> Visual Studio Premium <span class=\"token punctuation\">(</span>11111111-1111-4000-11111111111111111<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> MSI@50342\nSubscription       : 11111111-1111-4000-11111111111111111\nTenant             : 00000000-0000-4000-00000000000000000\n\nAzure:<span class=\"token operator\">/</span>\n<span class=\"token function\">PS</span> Azure:\\> <span class=\"token function\">Get-AzSubscription</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>Property Id<span class=\"token punctuation\">,</span> Name<span class=\"token punctuation\">,</span> TenantId <span class=\"token punctuation\">|</span> <span class=\"token function\">Format-List</span>\n\nId                        : 11111111-1111-4000-11111111111111111\nName                      : Windows Azure  MSDN <span class=\"token operator\">-</span> Visual Studio Premium\nTenantId                  : 00000000-0000-4000-00000000000000000\n\nId                        : 22222222-2222-4000-22222222222222222\nName                      : Azure Pass <span class=\"token operator\">-</span> Sponsorship\nTenantId                  : 00000000-0000-4000-00000000000000000</code></pre></div>\n<p><a href=\"https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-3.3.0\">Set-AzContext</a> lets me set <code class=\"language-text\">22222222-2222-4000-22222222222222222</code> as the default.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Azure:<span class=\"token operator\">/</span>\n<span class=\"token function\">PS</span> Azure:\\> <span class=\"token function\">Set-AzContext</span> <span class=\"token operator\">-</span>SubscriptionId 22222222-2222-4000-22222222222222222</code></pre></div>\n<p>However, that only affects PowerShell cmdlets and not the Azure CLI commands.  Running <a href=\"https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-list\">az account list</a> shows the default subscription for the Azure CLI is still <code class=\"language-text\">11111111-1111-4000-11111111111111111</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Azure:<span class=\"token operator\">/</span>\n<span class=\"token function\">PS</span> Azure:\\> az account list <span class=\"token operator\">--</span>query <span class=\"token string\">\"[].{Id:id,IsDefault:isDefault,Name:name,TenantId:tenantId}\"</span>\n<span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Id\"</span>: <span class=\"token string\">\"11111111-1111-4000-11111111111111111\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"IsDefault\"</span>: true<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Name\"</span>: <span class=\"token string\">\"Windows Azure  MSDN - Visual Studio Premium\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"TenantId\"</span>: <span class=\"token string\">\"00000000-0000-4000-00000000000000000\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Id\"</span>: <span class=\"token string\">\"22222222-2222-4000-22222222222222222\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"IsDefault\"</span>: false<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Name\"</span>: <span class=\"token string\">\"Azure Pass - Sponsorship\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"TenantId\"</span>: <span class=\"token string\">\"00000000-0000-4000-00000000000000000\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>I would need to use <a href=\"https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az-account-set\">az account set</a> with the <code class=\"language-text\">--subscription</code> parameter to use my “Azure Pass - Sponsorship” subscription.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Azure:<span class=\"token operator\">/</span>\n<span class=\"token function\">PS</span> Azure:\\> az account <span class=\"token function\">set</span> <span class=\"token operator\">--</span>subscription 22222222-2222-4000-22222222222222222</code></pre></div>\n<p>Now I need to remember to do these steps every time I start an Azure Cloud Shell.</p>","frontmatter":{"title":"Setting Subscription used inside Azure Cloud Shell","description":null,"date":"January 8, 2020","tags":["azure","cli","powershell","cloudshell"],"canonical":null}}},"pageContext":{"slug":"/2020-01-08-setting-subscription-used-inside-azure-cloud-shell","previous":{"fields":{"slug":"/2019-12-05-exam-az-900-microsoft-azure-fundamentals"},"frontmatter":{"tags":["azure","career","certification"]}},"next":{"fields":{"slug":"/2020-01-20-using-aws-x-ray-with-lambdaedge"},"frontmatter":{"tags":["aws","xray","cloudfront","monitoring"]}}}},"staticQueryHashes":["2589769190","97908498"]}