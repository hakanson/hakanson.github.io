{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-04-10-aws-iam-policy-for-service-user-s3-access","webpackCompilationHash":"f141a48750e2a6a883f2","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"2493a289-92c7-5d26-8692-9cce98cb4288","excerpt":"As a “security custodian” for some of my company’s AWS accounts, I review requests for what we call “service users,” including the AWS IAM Policy documents…","html":"<p>As a “security custodian” for some of my company’s AWS accounts, I review requests for what we call “service users,” including the AWS IAM Policy documents attached to those users. I prefer these to meet the <a href=\"https://en.wikipedia.org/wiki/Principle_of_least_privilege\">Principle of least privilege</a> but demand they are not overly aggressive.   Recently, I received this proposed policy:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:ListBucket\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:PutObject\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:s3:::*\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I replied that this would grant access to all S3 buckets and the <code class=\"language-text\">Resource</code> clause needed to be restricted to a specific bucket.  The requesting team responded with:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:ListBucket\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:PutObject\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n         <span class=\"token string\">\"arn:aws:s3:::project-bucket-name\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I realized I should have sent a link to <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/list_amazons3.html\">Actions, Resources, and Condition Keys for Amazon S3</a> because some S3 Actions apply to S3 <em>Buckets</em> and other to S3 <em>Objects</em>.  The ARN syntax for S3 Objects requires a slash ( <code class=\"language-text\">/</code> ) after the bucket name, where <code class=\"language-text\">/*</code> is the syntax for all objects.  The policy below includes a <code class=\"language-text\">Resource</code> array that includes both the Bucket and all the Objects.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:ListBucket\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:PutObject\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n         <span class=\"token string\">\"arn:aws:s3:::project-bucket-name\"</span><span class=\"token punctuation\">,</span>\n         <span class=\"token string\">\"arn:aws:s3:::project-bucket-name/*\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Strictly speaking, the above syntax includes some <code class=\"language-text\">Action</code> and <code class=\"language-text\">Resource</code> combinations that are not valid, but I feel it is more readable (and smaller in size) than the more correct syntax.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"s3:ListBucket\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n         <span class=\"token string\">\"arn:aws:s3:::project-bucket-name\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"s3:PutObject\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n         <span class=\"token string\">\"arn:aws:s3:::project-bucket-name/*\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"AWS IAM Policy for Service User S3 Access","date":"April 10, 2019","tags":["aws","iam","s3"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019-04-10-aws-iam-policy-for-service-user-s3-access","previous":{"fields":{"slug":"/2019-01-11-finding-all-aws-services-my-team-is-using"},"frontmatter":{"tags":["aws","python","iam"]}},"next":{"fields":{"slug":"/2019-04-22-goodbye-oracle-java-8-hello-amazon-corretto-8"},"frontmatter":{"tags":["opensource","java","macos"]}}}}}