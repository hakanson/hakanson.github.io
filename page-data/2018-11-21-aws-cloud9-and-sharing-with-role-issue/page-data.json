{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-11-21-aws-cloud9-and-sharing-with-role-issue","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"1d28cb8e-6a49-5495-8e4d-f53b8442c950","excerpt":"A co-worker and I were investigating AWS Cloud9 and the ability to share environments.  However, when you do a Window - Share… from inside the environment, you…","html":"<p>A co-worker and I were investigating <a href=\"https://aws.amazon.com/cloud9/\">AWS Cloud9</a> and the ability to share environments.  However, when you do a <strong>Window - Share…</strong> from inside the environment, you get this dialog:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 379px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/82e16ca28938d14d45afab1f9ed7afb6/811d1/pastedImage_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.40540540540542%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTUlEQVQ4y5VVa4/SUBDl//8Qdfmmq0sw0SUSv+gXTUxIBOVZWih90Rbo89gz3WHbNUvYm5zMvb3cc2fOzFw6o9EIs9kM0+lUMJ/PZb1cLmGa5ovAc53NZgPHcWDbNrbbrWC9XiMMQ5RliaIorkYcx+iQKAgC+L4vVgfJ8jxvHXi6boK/PxwONaHruuIlLQ+laSrgPMuyM56u9XdJkshaCD3Pk8lutxNCdd2yLJFBpeCa8hBc0xrGWrBYLOTsmXC/34uoJOLgbfSYl9AyHJXhcZRtVHuiIbUjM2+khrxJieiJasyLCe4L/ACWF8N0IiztPcJDguPxiA43OaElOQ+RgFmmpfec0xL1twBBGMHZV1IFlTxuhPiU1oSmtRENFPzYDI+2CQ0WMi9aYYuGvmPDcW1M/kzEA45L5dEqI5ZLhd/bKpFJidORSbGtaiMRQaMoOtfUNSjKOhm/zAKRErqe3wrxJZ2h0NDrsqmS0dSq2SnNccnTvNkpzC6rnck4nU5iCVZ/c62d8xzo6ZmQ2rHummAJac2xLjX7jwmhZyTKxZZlUZcNC3q1WsmzZRiGdMlzr4x6w8O1bu0hhCxkbWyCoZ1flgb0YcjzDFHVFeNtiu+LQYWP+Fbhh/Glbj2GRK3YDQQ/qmYHVn+SCdIsf0hCgTBO8NPIcD+5xefxDT6Nu/g6fY8ojmpC6qV9qy/JrtLxr+lhvgnEssVIdilkJlJCvjxKrZv/uuTu7gO63Ru8u32L129e1X8BSnhNAWuytP6GwyH6/T4GgwF6vZ4k9x8xFFP+51zrVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cloud9 Dialog\"\n        title=\"Cloud9 Dialog\"\n        src=\"/static/82e16ca28938d14d45afab1f9ed7afb6/811d1/pastedImage_3.png\"\n        srcset=\"/static/82e16ca28938d14d45afab1f9ed7afb6/12f09/pastedImage_3.png 148w,\n/static/82e16ca28938d14d45afab1f9ed7afb6/e4a3f/pastedImage_3.png 295w,\n/static/82e16ca28938d14d45afab1f9ed7afb6/811d1/pastedImage_3.png 379w\"\n        sizes=\"(max-width: 379px) 100vw, 379px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>However, we are not using IAM users, but roles assumed via SAML.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws sts get-caller-identity\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Account\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123456789012\"</span>,\n    <span class=\"token string\">\"UserId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:kevin.hakanson@example.com\"</span>,\n    <span class=\"token string\">\"Arn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/kevin.hakanson@example.com\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, I know that all AWS features have an API and can be called via the AWS CLI, so I thought I would just call <a href=\"https://docs.aws.amazon.com/cli/latest/reference/cloud9/create-environment-membership.html\">create-environment-membership</a> from the Cloud9 IDE integrated terminal.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws --version\naws-cli/1.15.83 Python/2.7.14 Linux/4.14.72-68.55.amzn1.x86_64 botocore/1.10.82\n\n$ aws ec2 describe-instances <span class=\"token punctuation\">\\</span>\n--instance-id <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> -s http://169.254.169.254/latest/meta-data/instance-id<span class=\"token variable\">)</span></span> <span class=\"token punctuation\">\\</span>\n--query <span class=\"token string\">\"Reservations[*].Instances[*].Tags[?Key=='aws:cloud9:environment'].Value\"</span> <span class=\"token punctuation\">\\</span>\n--output text\n6a26600d70aa41cd9b81bdb662b1c715\n\n$ aws cloud9 describe-environment-memberships --environment-id 6a26600d70aa41cd9b81bdb662b1c715\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"memberships\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"environmentId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"6a26600d70aa41cd9b81bdb662b1c715\"</span>, \n            <span class=\"token string\">\"lastAccess\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">1542842576.0</span>, \n            <span class=\"token string\">\"userId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:kevin.hakanson@example.com\"</span>, \n            <span class=\"token string\">\"userArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/kevin.hakanson@example.com\"</span>, \n            <span class=\"token string\">\"permissions\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"owner\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But it didn’t work as expected when I tried to add my trusted coworker. Adding the <strong>--debug</strong> flag didn’t give me any more info.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws cloud9 create-environment-membership <span class=\"token punctuation\">\\</span>\n--environment-id 6a26600d70aa41cd9b81bdb662b1c715 <span class=\"token punctuation\">\\</span>\n--user-arn arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/trusted.coworker@example.com <span class=\"token punctuation\">\\</span>\n--permissions read-only\n\nAn error occurred <span class=\"token punctuation\">(</span>UnrecognizedClientException<span class=\"token punctuation\">)</span> when calling the CreateEnvironmentMembership operation: The security token included <span class=\"token keyword\">in</span> the request is invalid</code></pre></div>\n<p>When I went to a terminal on my Mac and tried the same command (as the same assumed role), it succeeded.  So, it doesn’t seem like an IAM permission issue for my role.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws sts get-caller-identity\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"UserId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:kevin.hakanson@example.com\"</span>,\n    <span class=\"token string\">\"Account\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123456789012\"</span>,\n    <span class=\"token string\">\"Arn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/kevin.hakanson@example.com\"</span>\n<span class=\"token punctuation\">}</span>\n\n$ aws cloud9 create-environment-membership <span class=\"token punctuation\">\\</span>\n--environment-id 6a26600d70aa41cd9b81bdb662b1c715 <span class=\"token punctuation\">\\</span>\n--user-arn arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/trusted.coworker@example.com <span class=\"token punctuation\">\\</span>\n--permissions read-only --region us-east-2\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"membership\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"permissions\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"read-only\"</span>,\n        <span class=\"token string\">\"userId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:trusted.coworker@example.com\"</span>,\n        <span class=\"token string\">\"userArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/trusted.coworker@example.com\"</span>,\n        <span class=\"token string\">\"environmentId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"6a26600d70aa41cd9b81bdb662b1c715\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Back in the Cloud9 IDE terminal, I checked and saw the membership was updated.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws cloud9 describe-environment-memberships --environment-id 6a26600d70aa41cd9b81bdb662b1c715\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"memberships\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"environmentId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"6a26600d70aa41cd9b81bdb662b1c715\"</span>,\n            <span class=\"token string\">\"userId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:trusted.coworker@example.com\"</span>,\n            <span class=\"token string\">\"userArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/trusted.coworker@example.com\"</span>,\n            <span class=\"token string\">\"permissions\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"read-only\"</span>\n        <span class=\"token punctuation\">}</span>,\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"environmentId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"6a26600d70aa41cd9b81bdb662b1c715\"</span>,\n            <span class=\"token string\">\"lastAccess\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">1542846944.0</span>,\n            <span class=\"token string\">\"userId\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"AROAXXXXXXXXXXXXXXXXX:kevin.hakanson@example.com\"</span>,\n            <span class=\"token string\">\"userArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:sts::123456789012:assumed-role/projectID-PowerUser/kevin.hakanson@example.com\"</span>,\n            <span class=\"token string\">\"permissions\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"owner\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I’m not sure what went wrong.  There is no record in CloudTrail, but when I look at <a href=\"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-unsupported-aws-services.html\">CloudTrail Unsupported Services</a> I see AWS Cloud9 listed.  I did find in the <a href=\"https://docs.aws.amazon.com/cloud9/latest/user-guide/auth-and-access-control.html#auth-and-access-control-temporary-managed-credentials-supported\">Actions Supported by AWS Managed Temporary Credentials</a> for AWS Cloud9 EC2 development environments that there is an IAM restriction that could be responsible.</p>\n<blockquote>\n<p>All IAM actions that interact with roles are allowed only for role names starting with Cloud9-.</p>\n</blockquote>\n<p>This looks like an AWS Enterprise Support question - but a lower priority because I have a workaround (and it is Thanksgiving tomorrow and re:Invent next week).</p>\n<hr>\n<p><strong>Update:</strong>  Working with AWS Support, we realized I could add a role using the full arn via the UI. I closed my case with the suggestion that the “help text” on that “share this environment” screen should  be updated not just to reference “IAM username” but give an indication that a full ARN (include role) could be used.</p>","frontmatter":{"title":"AWS Cloud9 and Sharing with Role Issue","description":null,"date":"November 21, 2018","tags":["aws","cloud9","iam"],"canonical":null}}},"pageContext":{"slug":"/2018-11-21-aws-cloud9-and-sharing-with-role-issue","previous":{"fields":{"slug":"/2018-11-08-excited-about-azure-signalr-serviceaspnet-core-signalr"},"frontmatter":{"tags":["azure","dotnet","podcast"]}},"next":{"fields":{"slug":"/2018-11-21-cloudfront-and-disaster-recovery-part-2"},"frontmatter":{"tags":["aws","cloudfront","disasterrecovery"]}}}},"staticQueryHashes":["2589769190","3567236516"]}