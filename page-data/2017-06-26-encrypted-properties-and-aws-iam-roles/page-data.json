{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-06-26-encrypted-properties-and-aws-iam-roles","webpackCompilationHash":"2ff2dae5022005648504","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"e9914542-4fa6-5064-bc75-0e2235793979","excerpt":"I was working on a pattern for application teams to secure and encrypt sensitive properties like database passwords.  Below is an interaction flow where the DBA…","html":"<p>I was working on a pattern for application teams to secure and encrypt sensitive properties like database passwords.  Below is an interaction flow where the DBA for project 204503 can encrypt a property that only the intended microservice can decrypt.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c56e51dc5ffbee4a74ed930c080f7812/2d849/pastedImage_14.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.42372881355932%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABibAAAYmwFJdYOUAAAB80lEQVQoz12SW08TURSF+z999YdofDMafIJoDGrxydgYkRItxQiFllun0HZa2tLpBWfodQot07l0Zj5nzoBBV7KTs0/OWXutvXfM933CCLFYLLBMC8dxME0Ty7LwPA9FaaFqmnhnGAa+K57jBSF+3nGEEbsnc12XTqdDqVwSBLJcQa7I4u7J02csr7xmMpkwGgw5bebpHqxxvbUiCtxxCvwlDBWFykI4ro29MLlHNpdDkiRxNqYGe8cpSoffMN48YlbdwRSKXeEmFlYNVdTqdXq9Hl7A+Wlric3cqjjblsNwMIosuh66Psa1PJEfbic43/3IsPiFTDLO7ahNTNd1VFXFnJtMpmNawwrZk68USmnawyq54k9SmQ2aWoWZcYPv+diOJfpb3YnT2HpJP7uMnHzO9KpCLPIf2db0NvnTFEpNolDdJ1vcptDa5fOvVdY2Vig2jhn0IrW3gfrbica4W0ZTShiDOo45/ZfwatLmqJZEVjLkat9ZD+xIl2k28u/ZlOIU6yd0Wh1a4xrDH6+wLo75H7Fo3FFP1LESTDnNZSPPWS3LXiFN6fc+6wcfeJtY4truM7+Zksol0JIvmL17jGfPo5Xx3GhtHiq8MXQuNJluv4kS9KOungV5mXNVotw+wrBnwbIGxRfBgIKwA8u+u+Ahxx8g3ZVfVvIe2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DBA interaction\"\n        title=\"DBA interaction\"\n        src=\"/static/c56e51dc5ffbee4a74ed930c080f7812/b9e4f/pastedImage_14.png\"\n        srcset=\"/static/c56e51dc5ffbee4a74ed930c080f7812/cf440/pastedImage_14.png 148w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/d2d38/pastedImage_14.png 295w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/b9e4f/pastedImage_14.png 590w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/f9b6a/pastedImage_14.png 885w,\n/static/c56e51dc5ffbee4a74ed930c080f7812/2d849/pastedImage_14.png 1180w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In the diagram:</p>\n<ul>\n<li>A DBA human creates separate database users for service1 and service2</li>\n<li>\n<p>Assuming the <code class=\"language-text\">204503-DBA</code> IAM Role, the DBA encrypts the service1 user’s password (P@ssword1) and encrypts with CMK 1</p>\n<ul>\n<li>Pre-condition: CMK 1 was created with a Resource Policy that allows <code class=\"language-text\">204503-DBA</code> to <code class=\"language-text\">kms:Encrypt</code></li>\n</ul>\n</li>\n<li>\n<p>Assuming the <code class=\"language-text\">204503-DBA</code> IAM Role, the DBA encrypts the service2 user’s password (P@ssword2) and encrypts with CMK 2</p>\n<ul>\n<li>Pre-condition: CMK 2 was created with a Resource Policy that allows <code class=\"language-text\">204503-DBA</code> to <code class=\"language-text\">kms:Encrypt</code></li>\n</ul>\n</li>\n<li>The DBA puts the encrypted data into the location that deploys to the Config Server</li>\n</ul>\n<p>Later, in the diagram:</p>\n<ul>\n<li>\n<p>Instances of service1 are running with the <code class=\"language-text\">204503-service1</code> IAM Role</p>\n<ul>\n<li>They retrieve the encrypted property from the Config Server</li>\n<li>They decrypt the property using CMK 1</li>\n<li>Pre-condition: CMK 1 was created with a Resource Policy that allows <code class=\"language-text\">204503-service1</code> to <code class=\"language-text\">kms:Decrypt</code></li>\n<li>They connect to the database</li>\n</ul>\n</li>\n<li>\n<p>Instances of service2 are running with the <code class=\"language-text\">204503-service2</code> IAM Role</p>\n<ul>\n<li>They retrieve the encrypted property from the Config Server</li>\n<li>They decrypt the property using CMK 2</li>\n<li>Pre-condition: CMK 2 was created with a Resource Policy that allows <code class=\"language-text\">204503-service2</code> to <code class=\"language-text\">kms:Decrypt</code></li>\n<li>They connect to the database</li>\n</ul>\n</li>\n</ul>\n<p>Potentially, this could be altered to support an EncryptionContext with the service name as part of the key-value map.  See <a href=\"https://aws.amazon.com/blogs/security/how-to-protect-the-integrity-of-your-encrypted-data-by-using-aws-key-management-service-and-encryptioncontext/\">How to Protect the Integrity of Your Encrypted Data by Using AWS Key Management Service and EncryptionContext</a>) for more details and look for an upcoming post on the topic.</p>","frontmatter":{"title":"Encrypted Properties and AWS IAM Roles","date":"June 26, 2017","tags":["aws","iam","encryption","database","security"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017-06-26-encrypted-properties-and-aws-iam-roles","previous":{"fields":{"slug":"/2017-06-25-amazon-elasticsearch-service-and-iam-policies-on-http-methods"},"frontmatter":{"tags":["aws","iam","elasticsearch"]}},"next":{"fields":{"slug":"/2017-06-28-authenticated-encryption-with-the-aws-cli"},"frontmatter":{"tags":["aws","cli","encryption"]}}}}}