{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016-04-25-aws-waf-vs-modsecurity","result":{"data":{"site":{"siteMetadata":{"title":"kevinhakanson.com","author":"Kevin Hakanson"}},"markdownRemark":{"id":"d9e68779-43f5-50dc-9249-cf6ae28671ec","excerpt":"In a recent meeting with the corporate security team, it was mentioned that a Web Application Firewall (WAF) might be the recommendation for cloud projects to…","html":"<p>In a recent meeting with the corporate security team, it was mentioned that a Web Application Firewall (WAF) might be the recommendation for cloud projects to protect against XSS and SQL Injection.  The Cloud Security Workstream has done some research, including WAF options.  As I dug into what an AWS WAF solution might look like, I came up with this diagram:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7157823f3bdb46f3be99ca89a554e0d7/1cfc2/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABibAAAYmwFJdYOUAAACOklEQVQoz52Ty2oUQRSG5yl8Ale+iQ8g7hUfwIUgbkSIGFyoSMCFIEERFEEEr6hRNGaREBxxJvd0xp7unr5Md09fa7o7PfNJ1ThJRN1YcKCqTvGf/z//qcZ4PGYaatWC8WCL/12Nw+2YGhCdD7BwmqG3TppXJElMliYYlsOd91u0OzZ916Fn2ziej+042HaPMAyp65qGZFYUBVVVUZYVcdRH2BuI0KWsR6rUME9p7Rqcv7/My8UmIs/o+z6hsUsY+PjhAMuySJKERlmWCrAsCsSwoKtpfJmd4fvcDSLXodrfJ/B9iqKE1QfwegYyTxVK7p1BvL2p9q7rEscxDSEEX5tNWq02/SCktbLM6pWLbN2aZa/dwuz1MAxDRfjsKun8OZK9Jn4iCJYe4106Qbn5CSeIiaPBRPLOzg663lWy+37A2tIiu6srpFlOmqYThlWNv9dm8/Pzg67nRYXV/EidhThef8LwqEOyqaZhsK2brGsdwiCgrColR5pTSJkj8HwfyzRVoUr2uKwOJR8dGclQXsb6Bom5rfo37Y8oCvR3r2jevk5o94jiWJkwFALpg9xHUTRhOAWUCVltc+4s2vyFQ2lCYBldlk+d5OHxY/QW3vwxf1mW/QWwGFICGy/u4i49+TWeI6Rxw7Kk8/QR365dRnguo/GY0WikQjn+L4bSBNO00HX94AfJsQrCkH4U4w8ivCBA0zTFSr6fgsnzb4CymkzKRJam6vE0pAk/Oh2Mbled8zw/yE2B5U/5CVQHgmLMemgZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS Static Content - AWS WAF.png\"\n        title=\"AWS Static Content - AWS WAF.png\"\n        src=\"/static/7157823f3bdb46f3be99ca89a554e0d7/fcda8/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png\"\n        srcset=\"/static/7157823f3bdb46f3be99ca89a554e0d7/12f09/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png 148w,\n/static/7157823f3bdb46f3be99ca89a554e0d7/e4a3f/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png 295w,\n/static/7157823f3bdb46f3be99ca89a554e0d7/fcda8/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png 590w,\n/static/7157823f3bdb46f3be99ca89a554e0d7/efc66/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png 885w,\n/static/7157823f3bdb46f3be99ca89a554e0d7/1cfc2/AWS%2BStatic%2BContent%2B-%2BAWS%2BWAF.png 900w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Since <a href=\"https://aws.amazon.com/waf/\">AWS WAF</a> and its <a href=\"http://docs.aws.amazon.com/waf/latest/developerguide/web-acl.html\">Web ACL</a> rules are a feature of the <a href=\"https://aws.amazon.com/cloudfront/\">Amazon CloudFront CDN</a>, a full solution would pull in other Amazon functionality.  CloudFront is most useful as a CDN, if you host your static content assets in S3.  You can configure both an S3 Origin for your static content and a Custom Origin for your dynamic content.  In the diagram above, a “behavior” with the “path prefix” of <code class=\"language-text\">api/*</code> was used to route application requests to the ELB.</p>\n<p>However, this solution requires some DNS changes.  CloudFront will now be configured for application hostname, and the ELB needs a new hostname.  This is where things become interesting.  In the classic <code class=\"language-text\">www.example.com</code> scenario, you make CloudFront respond to <code class=\"language-text\">www.example.com</code>, and your original ELB becomes something like <code class=\"language-text\">origin-www.example.com</code>, reflecting the fact it is the “Origin” server.  Our products use “naked” domains meaning <code class=\"language-text\">example.com</code> is the hostname instead of the more traditional <code class=\"language-text\">www.example.com</code>.  This makes the naming of <code class=\"language-text\">origin.example.com</code> harder (since <code class=\"language-text\">origin-example.com</code> would be a new domain).  It also may require us to use Route 53 for DNS because the requirement for an ALIAS record for the zone apex (see <a href=\"http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-choosing-alias-non-alias.html\">Choosing Between Alias and Non-Alias Resource Record Sets - Amazon Route 53</a>).  This topic needs more investigation.</p>\n<p>Earlier, I investigated putting Apache HTTP in front of Zuul and use the ProxyPass directive to pass any <code class=\"language-text\">/api</code> URIs.  This was for HTTP/2 protocol support, but could also be used if we use the <a href=\"https://www.modsecurity.org/\">ModSecurity</a> Apache module as a WAF.  This solution means no new hostnames, less new infrastructure and could also be used by the deployments in the corporate data center until they can move to AWS.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f749210300bc0c5cd0f4930b0586f413/b12f7/AWS%2BStatic%2BContent%2B-%2BModSecurity.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABibAAAYmwFJdYOUAAABd0lEQVQoz1WRu27UQBSG/Vg8BQ9AS0XBA6SmogxdRJWCJqQnioQCEggKioREEGnXKNGa7NqxPbE9N8/FHxqvVsAvnat+nTnzn2yaJhJ2cSMUznmmGInBE2MgxkgI4R/zBO/+1t7NvIQsudRMkMrw/Oiad1cVYdS0akR0A33fo5RCSomUA8qM6MC2p+2cS6VxzpElN5v3yKGn+XKMvr3EdA3tySvU3QI9ev7D5hp1drDNxQr18TVOPSC1Ieu6jny5pFiXFPlPzOFTxpOXFEVBe/iM/uAJ1fo3rRB0QtArS5N/p37xiP50H1FXiP3HDMd7KOvJjDGcn19QliXDIMnPjih/fMUEKFe/WH94g+wEIcZZ5+A9EXhYfENevZ+XvL34zPrTW4wdtxrukDTpjcf6ad5mscxZrjY0bYu1dtYwxTTUTZCUj95xs7rjvlMYo8nSq7sLJ7JWEqM1wzDQNg3NfTUfpaqqWYa6rkm/SjwlJUprRrut03H/AC3bD9wESr6XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS Static Content - ModSecurity.png\"\n        title=\"AWS Static Content - ModSecurity.png\"\n        src=\"/static/f749210300bc0c5cd0f4930b0586f413/fcda8/AWS%2BStatic%2BContent%2B-%2BModSecurity.png\"\n        srcset=\"/static/f749210300bc0c5cd0f4930b0586f413/12f09/AWS%2BStatic%2BContent%2B-%2BModSecurity.png 148w,\n/static/f749210300bc0c5cd0f4930b0586f413/e4a3f/AWS%2BStatic%2BContent%2B-%2BModSecurity.png 295w,\n/static/f749210300bc0c5cd0f4930b0586f413/fcda8/AWS%2BStatic%2BContent%2B-%2BModSecurity.png 590w,\n/static/f749210300bc0c5cd0f4930b0586f413/efc66/AWS%2BStatic%2BContent%2B-%2BModSecurity.png 885w,\n/static/f749210300bc0c5cd0f4930b0586f413/b12f7/AWS%2BStatic%2BContent%2B-%2BModSecurity.png 1020w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>CloudFront will be an important feature for the United States, but for the South America and Australia deployments, there are fewer edge locations (see <a href=\"http://aws.amazon.com/cloudfront/details/\">Amazon CloudFront Product Details</a> ) and will be less customer traffic.  An alternate solution to AWS WAF may be the best solution for now.</p>","frontmatter":{"title":"AWS WAF vs. ModSecurity","description":null,"date":"April 25, 2016","tags":["aws","waf","webdev","security"],"canonical":null}}},"pageContext":{"slug":"/2016-04-25-aws-waf-vs-modsecurity","previous":{"fields":{"slug":"/2016-03-28-graph-encryption-going-beyond-encrypted-keyword-search"},"frontmatter":{"tags":["search","encryption"]}},"next":{"fields":{"slug":"/2016-05-03-introduction-to-speech-interfaces-for-web-applications"},"frontmatter":{"tags":["webdev","vui","conference"]}}}},"staticQueryHashes":["2589769190","97908498"]}